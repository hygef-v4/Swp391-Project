<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:inline="text" lang="en">
<head>
    <title>So sánh khách sạn</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/font-awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    <style>
        .compare-table th, .compare-table td { vertical-align: middle !important; font-size: 1.05rem; padding: 1.1rem 0.7rem; }
        .compare-table th { background: #f5f7fa; font-weight: bold; font-size: 1.12rem; color: #222; border-top: none; }
        .compare-table { border-radius: 18px; box-shadow: 0 4px 24px #0001; border: 1.5px solid #e3e8ee; width: 100%; table-layout: fixed; }
        .compare-table tr:nth-child(even) { background: #f8fafc; }
        .compare-table tr:nth-child(odd) { background: #fff; }
        .compare-table td, .compare-table th { border-color: #e3e8ee; }
        .compare-table td { transition: background 0.2s; }
        .compare-table td:hover { background: #f0f4fa; }
        .compare-avatar { width: 40px; height: 40px; object-fit: cover; border-radius: 50%; border: 2px solid #eee; }
        .compare-review-cell { max-width: 220px; min-width: 120px; word-break: break-word; white-space: normal; }
        .compare-review-rating { color: #ffc107; font-size: 1.2rem; margin-left: 4px; }
        .compare-review-name { font-weight: 700; font-size: 1.05rem; margin-right: 4px; display: block; white-space: normal; text-align: left; }
        .compare-review-comment { font-style: italic; color: #555; font-size: 0.98rem; line-height: 1.3; margin-top: 2px; white-space: normal; word-break: break-word; text-align: left; }
        .location-cell { white-space: normal !important; word-break: break-word !important; line-height: 1.5; text-align: left !important; }
        .compare-table .btn-outline-danger { border-radius: 50%; padding: 0.3rem 0.5rem; border-width: 2px; transition: background 0.2s, color 0.2s; }
        .compare-table .btn-outline-danger:hover { background: #ffebee; color: #c00; border-color: #c00; }
        .compare-table .btn-outline-primary.btn-lg { font-size: 1.1rem; padding: 0.7rem 1.3rem; border-radius: 2rem; }
        .compare-table .btn-outline-primary.btn-lg i { font-size: 1.3rem; vertical-align: -2px; }
        .badge.bg-success { font-size: 1.02rem; padding: 0.45em 0.9em; border-radius: 1.2em; }
        .badge.bg-success i { font-size: 1.1rem; margin-right: 2px; }
        @media (max-width: 900px) {
            .compare-table th, .compare-table td { font-size: 0.98rem; padding: 0.7rem 0.3rem; }
            .compare-table .btn-outline-primary.btn-lg { font-size: 0.98rem; padding: 0.5rem 1rem; }
        }
        @media (max-width: 600px) {
            .compare-table th, .compare-table td { font-size: 0.93rem; padding: 0.5rem 0.1rem; }
            .compare-table .btn-outline-primary.btn-lg { font-size: 0.93rem; padding: 0.4rem 0.7rem; }
            .compare-avatar { width: 32px; height: 32px; }
        }
        /* Đảm bảo bảng chính không tràn ngang */
        .table-responsive { overflow-x: unset !important; }
        .hotel-slider-container {
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 8px;
            margin-bottom: 0.5rem;
        }
        .hotel-slider-card {
            display: inline-block;
            vertical-align: top;
            width: 220px;
            margin-right: 18px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px #0001;
            cursor: pointer;
            transition: box-shadow 0.2s, transform 0.2s;
            border: 1.5px solid #e3e8ee;
        }
        .hotel-slider-card:hover {
            box-shadow: 0 4px 16px #0002;
            transform: translateY(-2px) scale(1.03);
            border-color: #a5d8ff;
        }
        .hotel-slider-card img {
            width: 100%; height: 120px; object-fit: cover; border-radius: 12px 12px 0 0;
        }
        .hotel-slider-card .card-body {
            padding: 0.7rem 0.6rem 0.6rem 0.6rem;
        }
        .hotel-slider-card .badge { font-size: 0.98rem; }
        .hotel-slider-card .text-muted { font-size: 0.97rem; }
    </style>
</head>
<body>
<!-- Header START -->
<div th:replace="~{common/header :: header}"></div>
<!-- Header END -->
<main>
    <section class="pt-5 pb-4 bg-light">
        <div class="container">
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <img src="/assets/images/element/compare.svg" alt="Compare" style="height:60px;">
                    <h1 class="mt-3">So sánh khách sạn</h1>
                    <p class="text-muted">So sánh tối đa 3 khách sạn theo các tiêu chí quan trọng nhất để chọn lựa phù hợp nhất cho bạn!</p>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered align-middle bg-white shadow-sm rounded-3 compare-table">
                    <tbody id="compareTableBody">
                        <!-- Nội dung sẽ được render bằng JS -->
                    </tbody>
                </table>
            </div>
            <div class="text-center mt-4">
                <a href="/hotel-list" class="btn btn-link"><i class="bi bi-arrow-left"></i> Quay lại danh sách khách sạn</a>
            </div>
        </div>
    </section>
</main>
<!-- Footer START -->
<div th:replace="~{common/footer :: footer}"></div>
<!-- Footer END -->
<!-- Modal chọn khách sạn -->
<div class="modal fade" id="selectHotelModal" tabindex="-1" aria-labelledby="selectHotelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="selectHotelModalLabel">Chọn khách sạn để so sánh</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3 align-items-end">
          <div class="col-md-3 mb-2 d-none"><!-- Ẩn filter loại khách sạn -->
            <label class="form-label mb-1">Loại khách sạn</label>
            <select class="form-select" id="filterCategory">
              <option value="">Tất cả loại khách sạn</option>
              <option value="resort">Resort</option>
              <option value="hotel">Hotel</option>
              <option value="apartment">Căn hộ</option>
            </select>
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label mb-1">Thành phố</label>
            <select class="form-select" id="filterCity">
              <option value="">Tất cả thành phố</option>
              <option value="Hà Nội">Hà Nội</option>
              <option value="Đà Nẵng">Đà Nẵng</option>
              <option value="Hồ Chí Minh">Hồ Chí Minh</option>
              <option value="Đà Lạt">Đà Lạt</option>
              <option value="Nha Trang">Nha Trang</option>
            </select>
          </div>
          <div class="col-md-4 mb-2">
            <label class="form-label mb-1">Khoảng giá</label>
            <input type="range" class="form-range" min="500000" max="2000000" step="50000" id="filterMinPrice" value="500000" oninput="document.getElementById('minPriceVal').innerText=this.value.toLocaleString('vi-VN')">
            <input type="range" class="form-range" min="500000" max="2000000" step="50000" id="filterMaxPrice" value="2000000" oninput="document.getElementById('maxPriceVal').innerText=this.value.toLocaleString('vi-VN')">
            <div class="d-flex justify-content-between small mt-1">
              <span id="minPriceVal">500,000</span>
              <span id="maxPriceVal">2,000,000</span>
            </div>
          </div>
          <div class="col-md-2 mb-2">
            <label class="form-label mb-1">Tên khách sạn</label>
            <input type="text" class="form-control" id="searchHotelName" placeholder="Tìm kiếm tên khách sạn...">
          </div>
        </div>
        <div class="row" id="hotelListPopup">
          <!-- Danh sách khách sạn mẫu sẽ render ở đây -->
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/js/functions.js"></script>
<script>
// Dữ liệu khách sạn đang so sánh (demo, tối đa 3)
let compareHotels = [
  {id: 101, name: 'Sunshine Resort', category: 'resort', image: '/assets/images/category/hotel/01.jpg', city: 'Đà Nẵng'},
  {id: 102, name: 'Central Hotel', category: 'hotel', image: '/assets/images/category/hotel/02.jpg', city: 'Hà Nội'},
  null
];
let selectedCompareIndex = null;

function renderCompareTable() {
  const table = document.getElementById('compareTableBody');
  if (!table) return;
  // Dữ liệu mẫu cho các trường chi tiết (demo, có thể mở rộng)
  const demoDetails = [
    {
      address: 'Số 11 Đường Demo, Hà Nội',
      city: 'Hà Nội',
      minPrice: 700000,
      amenities: ['Tiện nghi 1', 'Tiện nghi 2', 'Tiện nghi 4'],
      roomTypes: 2,
      totalRooms: 10,
      amenityCount: 3,
      maxGuests: 5,
      roomAreas: [22, 35], // diện tích các loại phòng (m²)
      review: { fullName: 'Người dùng 1', avatarUrl: '/assets/images/avatar/01.jpg', rating: 4, comment: 'Khách sạn rất tuyệt vời! Tôi sẽ quay lại lần nữa.' },
      rating: 4.3,
      hotelId: 101
    },
    {
      address: 'Số 12 Đường Demo, Đà Nẵng',
      city: 'Đà Nẵng',
      minPrice: 900000,
      amenities: ['Tiện nghi 1', 'Tiện nghi 2', 'Tiện nghi 4'],
      roomTypes: 2,
      totalRooms: 10,
      amenityCount: 3,
      maxGuests: 7,
      roomAreas: [28, 40],
      review: { fullName: 'Người dùng 1', avatarUrl: '/assets/images/avatar/01.jpg', rating: 5, comment: 'Khách sạn rất tuyệt vời! Tôi sẽ quay lại lần nữa.' },
      rating: 4.6,
      hotelId: 102
    },
    {
      address: 'Số 13 Đường Demo, Hồ Chí Minh',
      city: 'Hồ Chí Minh',
      minPrice: 1100000,
      amenities: [],
      roomTypes: 1,
      totalRooms: 10,
      amenityCount: 0,
      maxGuests: 0,
      roomAreas: [30],
      review: { fullName: 'Người dùng 1', avatarUrl: '/assets/images/avatar/01.jpg', rating: 4, comment: 'Khách sạn rất tuyệt vời! Tôi sẽ quay lại lần nữa.' },
      rating: 4.9,
      hotelId: 103
    }
  ];
  // Render các dòng tiêu chí chi tiết
  const rows = [
    {
      label: 'Tên khách sạn',
      render: (h, idx) => h ? `
        <div class='position-relative d-flex flex-column align-items-center justify-content-center' style='min-height:120px;'>
          <img src='${h.image}' style='width:120px;height:80px;object-fit:cover;border-radius:8px;margin-bottom:8px;'>
          <h5 class='mb-1 fw-bold' style='font-size:1.1rem;'>${h.name}</h5>
          <div class='mb-2'>
            <span class='badge bg-success'><i class='bi bi-star-fill text-warning'></i> ${demoDetails[idx]?.rating || ''}</span>
          </div>
          <button class='btn btn-outline-danger btn-sm position-absolute top-0 end-0' type='button' style='font-size:1.2rem;' onclick='removeHotel(${idx})' title='Xoá khách sạn'><i class="bi bi-x-lg"></i></button>
        </div>
      ` : `
        <div class='d-flex flex-column align-items-center justify-content-center' style='height: 120px;'>
          <button class='btn btn-outline-primary btn-lg' type='button' onclick='openSelectHotel(${idx})'><i class='bi bi-plus-circle'></i> Thêm khách sạn</button>
        </div>
      `
    },
    {
      label: 'Địa điểm',
      render: (h, idx) => h ? `<div class="location-cell"><i class="bi bi-geo-alt me-1"></i> ${demoDetails[idx]?.address || 'Không có thông tin'}, ${demoDetails[idx]?.city || ''}</div>` : ''
    },
    {
      label: 'Giá thấp nhất',
      render: (h, idx) => h ? `<span class='fw-bold text-success'>${demoDetails[idx]?.minPrice?.toLocaleString('vi-VN')}₫</span>/Ngày` : ''
    },
    {
      label: 'Tiện nghi nổi bật',
      render: (h, idx) => h ? `<ul class='list-unstyled mb-0' style='column-count:2;column-gap:1.5rem;'>${(demoDetails[idx]?.amenities?.length ? demoDetails[idx].amenities.map(a => `<li><i class='fa fa-check text-success me-2'></i>${a}</li>`).join('') : '<li>Không có thông tin</li>')}</ul>` : ''
    },
    {
      label: 'Số loại phòng',
      render: (h, idx) => h ? (demoDetails[idx]?.roomTypes > 0 ? demoDetails[idx].roomTypes : 'Không có thông tin') : ''
    },
    {
      label: 'Tổng số phòng',
      render: (h, idx) => h ? (demoDetails[idx]?.totalRooms > 0 ? demoDetails[idx].totalRooms : 'Không có thông tin') : ''
    },
    {
      label: 'Số lượng tiện nghi',
      render: (h, idx) => h ? (demoDetails[idx]?.amenityCount > 0 ? demoDetails[idx].amenityCount : 'Không có thông tin') : ''
    },
    {
      label: 'Số khách tối đa/phòng',
      render: (h, idx) => h ? (demoDetails[idx]?.maxGuests > 0 ? demoDetails[idx].maxGuests : 'Không có thông tin') : ''
    },
    {
      label: 'Diện tích phòng (m²)',
      render: (h, idx) => {
        if (!h) return '';
        const areas = demoDetails[idx]?.roomAreas || [];
        if (areas.length === 0) return 'Không có thông tin';
        if (areas.length === 1) return areas[0] + ' m²';
        const min = Math.min(...areas);
        const max = Math.max(...areas);
        return min === max ? `${min} m²` : `${min} - ${max} m²`;
      }
    },
    {
      label: 'Đánh giá nổi bật',
      render: (h, idx) => h ? `<div class='d-flex align-items-center mb-1'><img src='${demoDetails[idx]?.review?.avatarUrl}' class='compare-avatar me-2' alt='avatar'><div style='flex:1; min-width:0;'><span class='compare-review-name'>${demoDetails[idx]?.review?.fullName}</span><span class='compare-review-rating'>${'<i class="fa-solid fa-star"></i>'.repeat(demoDetails[idx]?.review?.rating || 0)}${'<i class="fa-regular fa-star"></i>'.repeat(5 - (demoDetails[idx]?.review?.rating || 0))}</span></div></div><div class='compare-review-comment'>${demoDetails[idx]?.review?.comment || ''}</div>` : ''
    },
    {
      label: 'Hành động',
      render: (h, idx) => h ? `<a href='/hotel-detail?hotelId=${demoDetails[idx]?.hotelId}' class='btn btn-outline-secondary btn-sm mb-1'><i class='bi bi-eye'></i> Xem chi tiết</a>` : ''
    }
  ];
  let html = '';
  for (const row of rows) {
    html += `<tr><td class='fw-bold text-center'>${row.label}</td>`;
    for (let i = 0; i < 3; i++) {
      html += `<td class='text-center align-middle'>${row.render(compareHotels[i], i) || ''}</td>`;
    }
    html += '</tr>';
  }
  table.innerHTML = html;
}

function addBtnHtml(idx) {
  return `<button class='btn btn-outline-primary' type='button' onclick='openSelectHotel(${idx})'><i class='bi bi-plus-circle'></i> Thêm khách sạn</button>`;
}

function removeHotel(idx) {
  compareHotels[idx] = null;
  renderCompareTable();
}
window.removeHotel = removeHotel;

function openSelectHotel(idx) {
  selectedCompareIndex = idx;
  var modal = new bootstrap.Modal(document.getElementById('selectHotelModal'));
  modal.show();
}
window.openSelectHotel = openSelectHotel;

// Đảm bảo demoHotels có trường minPrice
const demoHotels = [
  {id: 201, name: 'Sunshine Resort', category: 'resort', image: '/assets/images/category/hotel/01.jpg', city: 'Đà Nẵng', minPrice: 900000},
  {id: 202, name: 'Central Hotel', category: 'hotel', image: '/assets/images/category/hotel/02.jpg', city: 'Hà Nội', minPrice: 1200000},
  {id: 203, name: 'Luxury Apartment', category: 'apartment', image: '/assets/images/category/hotel/03.jpg', city: 'Hồ Chí Minh', minPrice: 1500000},
  {id: 204, name: 'Green Villa', category: 'resort', image: '/assets/images/category/hotel/04.jpg', city: 'Đà Lạt', minPrice: 800000},
  {id: 205, name: 'City View Hotel', category: 'hotel', image: '/assets/images/category/hotel/05.jpg', city: 'Nha Trang', minPrice: 1100000},
  {id: 206, name: 'Inter Resort', category: 'resort', image: '/assets/images/category/hotel/06.jpg', city: 'Đà Nẵng', minPrice: 1000000},
  {id: 207, name: 'Lakeview Apartment', category: 'apartment', image: '/assets/images/category/hotel/07.jpg', city: 'Hà Nội', minPrice: 1300000},
  {id: 208, name: 'Mountain Resort', category: 'resort', image: '/assets/images/category/hotel/08.jpg', city: 'Đà Lạt', minPrice: 950000},
  {id: 209, name: 'Ocean Pearl', category: 'hotel', image: '/assets/images/category/hotel/09.jpg', city: 'Nha Trang', minPrice: 1400000},
  {id: 210, name: 'Saigon Central', category: 'hotel', image: '/assets/images/category/hotel/10.jpg', city: 'Hồ Chí Minh', minPrice: 1700000},
  {id: 211, name: 'Inter Hotel', category: 'hotel', image: '/assets/images/category/hotel/11.jpg', city: 'Đà Nẵng', minPrice: 1050000},
  {id: 212, name: 'Sky Apartment', category: 'apartment', image: '/assets/images/category/hotel/12.jpg', city: 'Đà Nẵng', minPrice: 1150000}
];

function renderHotelListPopup() {
  // const filter = document.getElementById('filterCategory').value; // Bỏ filter loại
  const city = document.getElementById('filterCity').value;
  const minPrice = parseInt(document.getElementById('filterMinPrice').value) || 500000;
  const maxPrice = parseInt(document.getElementById('filterMaxPrice').value) || 2000000;
  const search = document.getElementById('searchHotelName').value.toLowerCase();
  const list = demoHotels.filter(h =>
    (!city || h.city === city) &&
    (h.minPrice >= minPrice && h.minPrice <= maxPrice) &&
    (!search || h.name.toLowerCase().includes(search))
  );
  const container = document.getElementById('hotelListPopup');
  if (list.length) {
    container.innerHTML = `<div class='hotel-slider-container'>` +
      list.map(h => `
        <div class="hotel-slider-card hotel-select-card" onclick="selectHotelForCompare(${h.id})">
          <img src="${h.image}" alt="${h.name}">
          <div class="card-body text-center">
            <h6 class="mb-1 fw-bold">${h.name}</h6>
            <div class="text-muted small mb-1"><i class='bi bi-geo-alt me-1'></i>${h.city}</div>
            <div class="text-success mt-1 fw-bold">${h.minPrice.toLocaleString('vi-VN')}₫</div>
          </div>
        </div>
      `).join('') + `</div>`;
  } else {
    container.innerHTML = '<div class="col-12 text-center text-muted">Không tìm thấy khách sạn phù hợp với tiêu chí lọc</div>';
  }
}

document.getElementById('filterCity').addEventListener('change', renderHotelListPopup);
document.getElementById('filterMinPrice').addEventListener('input', renderHotelListPopup);
document.getElementById('filterMaxPrice').addEventListener('input', renderHotelListPopup);
document.getElementById('searchHotelName').addEventListener('input', renderHotelListPopup);
document.addEventListener('DOMContentLoaded', renderHotelListPopup);

// Khi chọn khách sạn trong popup
function selectHotelForCompare(id) {
  const hotel = demoHotels.find(h => h.id === id);
  if (hotel && selectedCompareIndex !== null) {
    compareHotels[selectedCompareIndex] = hotel;
    renderCompareTable();
    var modal = bootstrap.Modal.getInstance(document.getElementById('selectHotelModal'));
    if (modal) modal.hide();
    selectedCompareIndex = null;
  }
}
window.selectHotelForCompare = selectHotelForCompare;

// Render bảng khi load trang
window.addEventListener('DOMContentLoaded', function() {
  renderCompareTable();
});
</script>
</body>
</html> 