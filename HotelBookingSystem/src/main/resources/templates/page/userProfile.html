<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<!-- Mirrored from stackbros.in/bookinga/landing/account-profile.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:32 GMT -->
<head>
    <title>Hamora - User's Profile</title>

    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="StackBros">
    <meta name="description" content="Booking - Multipurpose Online Booking Theme">

    <!-- Dark mode -->
    <script>
        const storedTheme = localStorage.getItem('theme')

        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        const setTheme = function (theme) {
            if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-bs-theme', 'dark')
            } else {
                document.documentElement.setAttribute('data-bs-theme', theme)
            }
        }

        setTheme(getPreferredTheme())

        window.addEventListener('DOMContentLoaded', () => {
            var el = document.querySelector('.theme-icon-active');
            if (el != 'undefined' && el != null) {
                const showActiveTheme = theme => {
                    const activeThemeIcon = document.querySelector('.theme-icon-active use')
                    const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
                    const svgOfActiveBtn = btnToActive.querySelector('.mode-switch use').getAttribute('href')

                    document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                        element.classList.remove('active')
                    })

                    btnToActive.classList.add('active')
                    activeThemeIcon.setAttribute('href', svgOfActiveBtn)
                }

                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                    if (storedTheme !== 'light' || storedTheme !== 'dark') {
                        setTheme(getPreferredTheme())
                    }
                })

                showActiveTheme(getPreferredTheme())

                document.querySelectorAll('[data-bs-theme-value]')
                    .forEach(toggle => {
                        toggle.addEventListener('click', () => {
                            const theme = toggle.getAttribute('data-bs-theme-value')
                            localStorage.setItem('theme', theme)
                            setTheme(theme)
                            showActiveTheme(theme)
                        })
                    })

            }
        })

    </script>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&amp;family=Poppins:wght@400;500;700&amp;display=swap">

    <!-- Plugins CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/vendor/font-awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/flatpickr/css/flatpickr.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendor/choices/css/choices.min.css">

    <!-- Theme CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">

</head>

<body class="dashboard">

<!-- Header START -->
<div th:replace="~{common/header :: header}"></div>
<!-- Header END -->

<!-- **************** MAIN CONTENT START **************** -->
<main>

    <!-- =======================
    Content START -->
    <section class="pt-3">
        <div class="container">
            <div class="row">

                <!-- Sidebar START -->
                <div th:replace="~{common/sidebar-profile :: sidebar}"></div>
                <!-- Sidebar END -->

                <!-- Main content START -->
                <div class="col-lg-8 col-xl-9">

                    <!-- Offcanvas menu button -->
                    <div class="d-grid mb-0 d-lg-none w-100">
                        <button class="btn btn-primary mb-4" type="button" data-bs-toggle="offcanvas"
                                data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
                            <i class="fas fa-sliders-h"></i> Menu
                        </button>
                    </div>

                    <div class="vstack gap-4">
                        <!-- Bắt đầu phần thông báo -->
                        <div class="mb-4">
                            <!-- Thông báo thành công -->
                            <div th:if="${success}" class="alert alert-success alert-dismissible fade show"
                                 role="alert">
                                <span th:text="${success}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                        aria-label="Đóng"></button>
                            </div>

                            <!-- Thông báo lỗi -->
                            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                                <span th:text="${error}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                        aria-label="Đóng"></button>
                            </div>
                        </div>
                        <!-- Kết thúc phần thông báo -->
                        <!-- Verified message -->
                        <!--                        <div class="bg-light rounded p-3">-->
                        <!--                             Progress bar -->
                        <!--                            <div class="overflow-hidden">-->
                        <!--                                <h6>Complete Your Profile</h6>-->
                        <!--                                <div class="progress progress-sm bg-success bg-opacity-10">-->
                        <!--                                    <div class="progress-bar bg-success aos" role="progressbar" data-aos="slide-right" data-aos-delay="200" data-aos-duration="1000" data-aos-easing="ease-in-out" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">-->
                        <!--                                        <span class="progress-percent-simple h6 fw-light ms-auto">85%</span>-->
                        <!--                                    </div>-->
                        <!--                                </div>-->
                        <!--                                <p class="mb-0">Get the best out of booking by adding the remaining details!</p>-->
                        <!--                            </div>-->
                        <!--                             Content -->
                        <!--                            <div class="bg-body rounded p-3 mt-3">-->
                        <!--                                <ul class="list-inline hstack flex-wrap gap-2 justify-content-between mb-0">-->
                        <!--                                    <li class="list-inline-item h6 fw-normal mb-0"><a href="#"><i class="bi bi-check-circle-fill text-success me-2"></i>Verified Email</a></li>-->
                        <!--                                    <li class="list-inline-item h6 fw-normal mb-0"><a href="#"><i class="bi bi-check-circle-fill text-success me-2"></i>Verified Mobile Number</a></li>-->
                        <!--                                    <li class="list-inline-item h6 fw-normal mb-0"><a href="#" class="text-primary"><i class="bi bi-plus-circle-fill me-2"></i>Complete Basic Info</a></li>-->
                        <!--                                </ul>-->
                        <!--                            </div>-->
                        <!--                        </div>-->

                        <!-- Personal info START -->
                        <div class="card border">
                            <!-- Card header -->
                            <div class="card-header border-bottom">
                                <h4 class="mb-4">Cập nhật thông tin cá nhân</h4>
                            </div>
                            <!-- Card body START -->
                            <div class="card-body">
                                <!-- Form START -->
                                <form th:action="@{/update-user-profile}" method="post" class="row g-3" id="userProfileForm">

                                    <!-- Profile photo -->
                                    <div class="col-12">
                                        <label class="form-label">Upload your profile photo<span
                                                class="text-danger">*</span></label>
                                        <div class="d-flex align-items-center">
                                            <label class="position-relative me-4" for="uploadfile-1"
                                                   title="Replace this pic">
                                                <!-- Avatar place holder -->
                                                <span class="avatar avatar-xl">
												<img id="uploadfile-1-preview"
                                                     class="avatar-img rounded-circle border border-white border-3 shadow"
                                                     th:src="${(session.user.avatarUrl == null or session.user.avatarUrl == '') ? '/assets/images/avatar/avatar.jpg' : session.user.avatarUrl}"
                                                     src="/assets/images/avatar/avatar.jpg" alt="">
											</span>
                                            </label>
                                            <!-- Upload button -->
                                            <label class="btn btn-sm btn-primary-soft mb-0 me-2"
                                                   for="uploadfile-1">Change</label>
                                            <button type="button" id="delete-avatar-btn" class="btn btn-sm btn-outline-danger mb-0">Xoá ảnh</button>
                                            <input id="uploadfile-1" class="form-control d-none" type="file" accept="image/*">
                                        </div>
                                        <!-- Loading spinner -->
                                        <div id="avatar-upload-loading" style="display:none; align-items:center;" class="mt-2">
                                            <div class="spinner-border text-primary" role="status" style="width: 1.2rem; height: 1.2rem;">
                                                <span class="visually-hidden">Uploading...</span>
                                            </div>
                                            <span class="ms-2">Đang tải ảnh lên...</span>
                                        </div>
                                        <!-- Hidden input for avatarUrl -->
                                        <input type="hidden" name="avatarUrl" id="avatarUrlInput">
                                    </div>

                                    <!-- Tên người dùng -->
                                    <div class="col-md-6">
                                        <label class="form-label">Tên người dùng</label>
                                        <input type="text" class="form-control" name="fullname" th:value="${session.user.fullName}" required>
                                    </div>


                                    <!-- Email -->
                                    <div class="col-md-6">
                                        <label class="form-label">Email<span
                                                class="text-danger">*</span></label>
                                        <input type="email" class="form-control" name="email" th:value="${session.user.email}"
                                               placeholder="Enter your email id" readonly style="opacity: 0.5; pointer-events: none;">
                                    </div>

                                    <!-- Số điện thoại -->
                                    <div class="col-md-6">
                                        <label class="form-label">Số điện thoại</label>
                                        <input type="text" class="form-control" name="phone" th:value="${session.user.phone}">
                                    </div>


                                    <!--                                     Nationality-->
                                    <!--                                    <div class="col-md-6">-->
                                    <!--                                        <label class="form-label">Nationality<span class="text-danger">*</span></label>-->
                                    <!--                                        <select class="form-select js-choice">-->
                                    <!--                                            <option value="">Select your country</option>-->
                                    <!--                                            <option>USA</option>-->
                                    <!--                                            <option selected>Paris</option>-->
                                    <!--                                            <option>India</option>-->
                                    <!--                                            <option>UK</option>-->
                                    <!--                                        </select>-->
                                    <!--                                    </div>-->

                                    <!--                                     Date of birth-->
                                    <div class="col-md-6">
                                        <label class="form-label">Date of Birth</label>
                                        <input type="date" class="form-control" name="dob" th:value="${session.user.dob}">
                                    </div>


                                    <!--Gender-->
                                    <div class="col-md-6">
                                        <label class="form-label">Gender</label>
                                        <select class="form-select" name="gender">
                                            <option value="Male" th:selected="${session.user.gender eq 'Male'}">Male</option>
                                            <option value="Female" th:selected="${session.user.gender eq 'Female'}">Female</option>
                                            <option value="Other" th:selected="${session.user.gender eq 'Other'}">Other</option>
                                        </select>
                                    </div>


<!--                                     Bio-->
                                    <div class="col-12">
                                        <label class="form-label">Bio</label>
                                        <textarea class="form-control" name="bio" th:text="${session.user.bio}"></textarea>
                                        <small class="text-muted">* Không quá 255 ký tự.</small>
                                    </div>

                                    <!-- Button -->
                                    <div class="col-12 text-end">
                                        <button type="submit" class="btn btn-primary">Cập nhật</button>
                                    </div>
                                </form>
                                <!-- Form END -->
                            </div>
                            <!-- Card body END -->
                        </div>
                        <!-- Personal info END -->

                        <!-- Update email START -->
<!--                        <div class="card border">-->
<!--                            &lt;!&ndash; Card header &ndash;&gt;-->
<!--                            <div class="card-header border-bottom">-->
<!--                                <h4 class="card-header-title">Update email</h4>-->
<!--                                <p class="mb-0">Your current email address is <span class="text-primary">example@gmail.com</span>-->
<!--                                </p>-->
<!--                            </div>-->

<!--                            &lt;!&ndash; Card body START &ndash;&gt;-->
<!--                            <div class="card-body">-->
<!--                                <form>-->
<!--                                    &lt;!&ndash; Email &ndash;&gt;-->
<!--                                    <label class="form-label">Enter your new email id<span class="text-danger">*</span></label>-->
<!--                                    <input type="email" class="form-control" placeholder="Enter your email id">-->

<!--                                    <div class="text-end mt-3">-->
<!--                                        <a href="#" class="btn btn-primary mb-0">Save Email</a>-->
<!--                                    </div>-->
<!--                                </form>-->
<!--                            </div>-->
<!--                            &lt;!&ndash; Card body END &ndash;&gt;-->
<!--                        </div>-->
                        <!-- Update email END -->

                        <!-- Update Password START -->
<!--<div class="card border">-->
<!--    <div class="card-header border-bottom">-->
<!--        <h4 class="card-header-title">Cập nhật mật khẩu</h4>-->
<!--    </div>-->

<!--    <form class="card-body" th:action="@{/update-password}" method="post">-->
<!--        &lt;!&ndash; Token &ndash;&gt;-->
<!--        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->

<!--        &lt;!&ndash; Current Password &ndash;&gt;-->
<!--        <div class="mb-3" th:if="${!passwordNotSet}">-->
<!--            <label class="form-label">Mật khẩu hiện tại</label>-->
<!--            <input class="form-control" type="password" name="currentPassword"-->
<!--                placeholder="Nhập mật khẩu hiện tại">-->
<!--        </div>-->
<!--        -->
<!--        &lt;!&ndash; New Password &ndash;&gt;-->
<!--        <div class="mb-3">-->
<!--            <label class="form-label">Mật khẩu mới</label>-->
<!--            <input class="form-control" type="password" name="newPassword"-->
<!--                placeholder="Nhập mật khẩu mới" required minlength="8">-->
<!--        </div>-->
<!--        -->
<!--        &lt;!&ndash; Confirm Password &ndash;&gt;-->
<!--        <div class="mb-3">-->
<!--            <label class="form-label">Xác nhận mật khẩu mới</label>-->
<!--            <input class="form-control" type="password" name="confirmPassword"-->
<!--                placeholder="Nhập lại mật khẩu mới" required>-->
<!--        </div>-->
<!--        -->
<!--        &lt;!&ndash; Submit Button &ndash;&gt;-->
<!--        <div class="text-end">-->
<!--            <button type="submit" class="btn btn-primary mb-0">Đổi mật khẩu</button>-->
<!--        </div>-->
<!--    </form>-->
<!--</div>-->
<!-- Update Password END -->
                    </div>
                </div>
                <!-- Main content END -->

            </div>
        </div>
    </section>
    <!-- =======================
    Content END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- =======================
Footer START -->
<div th:replace="~{common/footer :: footer}"></div>
<!-- =======================
Footer END -->

<!-- Back to top -->
<div class="back-top"></div>

<!-- Bootstrap JS -->
<script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<!-- Vendors -->
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/flatpickr/js/flatpickr.min.js"></script>
<script src="assets/vendor/choices/js/choices.min.js"></script>

<!-- ThemeFunctions -->
<script src="assets/js/functions.js"></script>

<script>
// Validation rules
const profileRules = {
    fullname: {
        required: true,
        minLength: 3,
        maxLength: 50,
        message: 'Tên người dùng phải từ 3-50 ký tự'
    },
    phone: {
        required: true,
        pattern: /^\d{10,15}$/,
        message: 'Số điện thoại phải từ 10-15 chữ số'
    },
    dob: {
        required: true,
        message: 'Ngày sinh không được để trống',
        validate: function(value) {
            // Định dạng yyyy-mm-dd
            if (!/^\d{4}-\d{2}-\d{2}$/.test(value)) return 'Ngày sinh không hợp lệ (yyyy-mm-dd)';
            const date = new Date(value);
            const now = new Date();
            if (isNaN(date.getTime())) return 'Ngày sinh không hợp lệ';
            if (date > now) return 'Ngày sinh không được lớn hơn hiện tại';
            // Tuổi tối thiểu 10
            const age = now.getFullYear() - date.getFullYear() - (now < new Date(now.getFullYear(), date.getMonth(), date.getDate()) ? 1 : 0);
            if (age < 10) return 'Bạn phải từ 10 tuổi trở lên';
            return null;
        }
    },
    bio: {
        maxLength: 255,
        message: 'Giới thiệu không quá 255 ký tự'
    }
};

function showFieldError(element, message) {
    element.classList.add('is-invalid');
    let error = element.parentNode.querySelector('.invalid-feedback');
    if (!error) {
        error = document.createElement('div');
        error.className = 'invalid-feedback';
        element.parentNode.appendChild(error);
    }
    error.textContent = message;
}
function removeFieldError(element) {
    element.classList.remove('is-invalid');
    let error = element.parentNode.querySelector('.invalid-feedback');
    if (error) error.remove();
}
function validateField(element) {
    const name = element.name;
    const value = element.value.trim();
    const rule = profileRules[name];
    removeFieldError(element);
    if (!rule) return true;
    if (rule.required && value === '') {
        showFieldError(element, rule.message || 'Trường này là bắt buộc');
        return false;
    }
    if (rule.minLength && value.length < rule.minLength) {
        showFieldError(element, rule.message);
        return false;
    }
    if (rule.maxLength && value.length > rule.maxLength) {
        showFieldError(element, rule.message);
        return false;
    }
    if (rule.pattern && !rule.pattern.test(value)) {
        showFieldError(element, rule.message);
        return false;
    }
    if (rule.validate) {
        const err = rule.validate(value);
        if (err) {
            showFieldError(element, err);
            return false;
        }
    }
    return true;
}
// Real-time validation
const form = document.getElementById('userProfileForm');
if (form) {
    form.querySelectorAll('input, textarea').forEach(input => {
        input.addEventListener('input', function() {
            validateField(this);
        });
    });
    form.addEventListener('submit', function(e) {
        let valid = true;
        form.querySelectorAll('input, textarea').forEach(input => {
            if (!validateField(input)) valid = false;
        });
        if (!valid) {
            e.preventDefault();
        }
    });
}

// Avatar upload logic
const avatarInput = document.getElementById('uploadfile-1');
const avatarPreview = document.getElementById('uploadfile-1-preview');
const avatarUrlInput = document.getElementById('avatarUrlInput');

const submitBtn = document.querySelector('#userProfileForm button[type="submit"]');
const avatarLoading = document.getElementById('avatar-upload-loading');
let avatarUploading = false;
let avatarSuccessTimeout;

avatarInput.addEventListener('change', async function() {
    const file = this.files[0];
    if (!file) return;
    // Validate file type
    const validTypes = ["image/jpeg", "image/png", "image/webp", "image/gif"];
    const maxSize = 5 * 1024 * 1024; // 5MB
    if (!validTypes.includes(file.type)) {
        alert("Chỉ chấp nhận ảnh JPG, PNG, GIF hoặc WEBP.");
        this.value = '';
        return;
    }
    if (file.size > maxSize) {
        alert("Ảnh không được lớn hơn 5MB.");
        this.value = '';
        return;
    }
    avatarUploading = true;
    if (submitBtn) submitBtn.disabled = true;
    if (avatarLoading) avatarLoading.style.display = 'inline-flex';
    // Preview
    const reader = new FileReader();
    reader.onload = function(e) {
        avatarPreview.src = e.target.result;
    };
    reader.readAsDataURL(file);
    // Upload to Cloudinary via backend API
    const formData = new FormData();
    formData.append('file', file);
    formData.append('folder', 'avatars');
    try {
        const response = await fetch('/api/files/upload/image', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        if (data.url) {
            avatarUrlInput.value = data.url;
            // Hiệu ứng success: viền avatar xanh
            avatarPreview.classList.add('border-success');
            if (avatarSuccessTimeout) clearTimeout(avatarSuccessTimeout);
            avatarSuccessTimeout = setTimeout(() => {
                avatarPreview.classList.remove('border-success');
            }, 2000);
        } else {
            alert('Lỗi upload ảnh đại diện!');
        }
    } catch (err) {
        alert('Lỗi upload ảnh đại diện!');
    }
    avatarUploading = false;
    if (submitBtn) submitBtn.disabled = false;
    if (avatarLoading) avatarLoading.style.display = 'none';
});

form.addEventListener('submit', function(e) {
    if (avatarUploading) {
        e.preventDefault();
        alert('Vui lòng chờ upload ảnh đại diện xong!');
    }
});

const deleteAvatarBtn = document.getElementById('delete-avatar-btn');
const defaultAvatar = '/assets/images/avatar/avatar.jpg';

deleteAvatarBtn.addEventListener('click', function() {
    avatarPreview.src = defaultAvatar;
    avatarUrlInput.value = '';
    avatarInput.value = '';
});
</script>

</body>

<!-- Mirrored from stackbros.in/bookinga/landing/account-profile.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:33 GMT -->
</html>