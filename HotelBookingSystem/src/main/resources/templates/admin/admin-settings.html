<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from stackbros.in/bookinga/landing/admin-settings.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:54 GMT -->
<head>
	<title>Booking - Multipurpose Online Booking Theme</title>

	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="StackBros">
	<meta name="description" content="Booking - Multipurpose Online Booking Theme">

	<!-- Dark mode -->
	<script>
		const storedTheme = localStorage.getItem('theme')
 
		const getPreferredTheme = () => {
			if (storedTheme) {
				return storedTheme
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
		}

		const setTheme = function (theme) {
			if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
				document.documentElement.setAttribute('data-bs-theme', 'dark')
			} else {
				document.documentElement.setAttribute('data-bs-theme', theme)
			}
		}

		setTheme(getPreferredTheme())

		window.addEventListener('DOMContentLoaded', () => {
		    var el = document.querySelector('.theme-icon-active');
			if(el != 'undefined' && el != null) {
				const showActiveTheme = theme => {
				const activeThemeIcon = document.querySelector('.theme-icon-active use')
				const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
				const svgOfActiveBtn = btnToActive.querySelector('.mode-switch use').getAttribute('href')

				document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
					element.classList.remove('active')
				})

				btnToActive.classList.add('active')
				activeThemeIcon.setAttribute('href', svgOfActiveBtn)
			}

			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
				if (storedTheme !== 'light' || storedTheme !== 'dark') {
					setTheme(getPreferredTheme())
				}
			})

			showActiveTheme(getPreferredTheme())

			document.querySelectorAll('[data-bs-theme-value]')
				.forEach(toggle => {
					toggle.addEventListener('click', () => {
						const theme = toggle.getAttribute('data-bs-theme-value')
						localStorage.setItem('theme', theme)
						setTheme(theme)
						showActiveTheme(theme)
					})
				})

			}
		})
		
	</script>

	<!-- Favicon -->
	<link rel="shortcut icon" th:href="@{/assets/images/favicon.ico}">

	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&amp;family=Poppins:wght@400;500;700&amp;display=swap">

	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/font-awesome/css/all.min.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/overlay-scrollbar/css/overlayscrollbars.min.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/flatpickr/css/flatpickr.min.css}">

	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" th:href="@{/assets/css/style.css}">

	<!-- Custom CSS for Settings -->
	<style>
		#updateBtn:disabled {
			cursor: not-allowed;
			opacity: 0.6;
		}

		#changeIndicator {
			border-left: 4px solid #0dcaf0;
			animation: fadeIn 0.3s ease-in;
		}

		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(-10px); }
			to { opacity: 1; transform: translateY(0); }
		}

		.form-control:focus {
			border-color: #0d6efd;
			box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
		}

		.btn-group-settings {
			gap: 0.5rem;
		}

		.settings-form-section {
			background: #f8f9fa;
			border-radius: 8px;
			padding: 1.5rem;
			margin-bottom: 2rem;
		}
	</style>

</head>

<body>

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
	<!-- Sidebar START -->
	<div th:replace="~{common-admin/admin-sidebar :: admin_sidebar}"></div>
	<!-- Sidebar END -->
	
	<!-- Page content START -->
	<div class="page-content">
	
		<!-- Top bar START -->
		<div th:replace="~{common-admin/admin-topbar :: admin_topbar}"></div>
		<!-- Top bar END -->
	
		<!-- Page main content START -->
		<div class="page-content-wrapper p-xxl-4">
	
			<!-- Title -->
			<div class="row">
				<div class="col-12 mb-4 mb-sm-5">
					<h1 class="h3 mb-0">Cài đặt hệ thống</h1>
				</div>
			</div>

			<form th:action="@{/admin/website-settings}" method="post" id="settingsForm">
				<!-- Hidden fields to store original values -->
				<input type="hidden" id="originalSiteName" th:value="${settings.siteName}">
				<input type="hidden" id="originalSupportEmail" th:value="${settings.supportEmail}">
				<input type="hidden" id="originalContactPhone" th:value="${settings.contactPhone}">
				<input type="hidden" id="originalContactAddress" th:value="${settings.contactAddress}">

				<div class="mb-3">
					<label class="form-label">Tên website</label>
					<input type="text" class="form-control" th:value="${settings.siteName}" name="siteName" id="siteName" required>
				</div>
				<div class="mb-3">
					<label class="form-label">Email hỗ trợ</label>
					<input type="email" class="form-control" th:value="${settings.supportEmail}" name="supportEmail" id="supportEmail" required>
				</div>
				<div class="mb-3">
					<label class="form-label">Số điện thoại liên hệ</label>
					<input type="text" class="form-control" th:value="${settings.contactPhone}" name="contactPhone" id="contactPhone">
				</div>
				<div class="mb-3">
					<label class="form-label">Địa chỉ liên hệ</label>
					<textarea class="form-control" name="contactAddress" id="contactAddress" th:text="${settings.contactAddress}"></textarea>
				</div>
				<div class="d-flex gap-2">
					<button type="submit" class="btn btn-primary" id="updateBtn">
						<i class="bi bi-check-circle"></i> Cập nhật
					</button>
					<button type="button" class="btn btn-outline-secondary" id="resetBtn">
						<i class="bi bi-arrow-clockwise"></i> Khôi phục
					</button>
				</div>

				<!-- Change indicator -->
				<div id="changeIndicator" class="alert alert-info mt-3" style="display: none;">
					<i class="bi bi-info-circle"></i> Có thay đổi chưa được lưu
				</div>
			</form>

			<!-- Messages -->
			<div th:if="${success}" class="alert alert-success mt-3">
				<i class="bi bi-check-circle"></i> Cập nhật thành công!
			</div>
			<div th:if="${error}" class="alert alert-danger mt-3">
				<i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
			</div>
			<div th:if="${warning}" class="alert alert-warning mt-3">
				<i class="bi bi-exclamation-circle"></i> <span th:text="${warning}"></span>
			</div>

			<h2 class="mt-5">Lịch sử hoạt động quản trị</h2>

			<!-- Filter Form -->
			<div class="card mb-4">
				<div class="card-body">
					<form method="get" th:action="@{/admin/website-settings}">
						<div class="row">
							<div class="col-md-3 mb-3">
								<label class="form-label">Admin</label>
								<select class="form-select" name="adminFilter">
									<option value="">Tất cả Admin</option>
									<option th:each="admin : ${uniqueAdmins}"
									        th:value="${admin}"
									        th:text="${admin}"
									        th:selected="${admin == adminFilter}"></option>
								</select>
							</div>
							<div class="col-md-4 mb-3">
								<label class="form-label">Hành động</label>
								<select class="form-select" name="actionFilter">
									<option value="">Tất cả hành động</option>
									<option th:each="action : ${uniqueActions}"
									        th:value="${action}"
									        th:text="${action}"
									        th:selected="${action == actionFilter}"></option>
								</select>
							</div>
							<div class="col-md-3 mb-3">
								<label class="form-label">Số bản ghi</label>
								<select class="form-select" name="size">
									<option value="5" th:selected="${pageSize == 5}">5</option>
									<option value="10" th:selected="${pageSize == 10}">10</option>
									<option value="20" th:selected="${pageSize == 20}">20</option>
									<option value="50" th:selected="${pageSize == 50}">50</option>
								</select>
							</div>
							<div class="col-md-2 mb-3">
								<label class="form-label">&nbsp;</label>
								<div class="d-flex gap-2">
									<a th:href="@{/admin/website-settings}" class="btn btn-outline-secondary flex-fill">
										<i class="bi bi-arrow-clockwise"></i> Đặt lại
									</a>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>

			<!-- Results Summary -->
			<div class="d-flex justify-content-between align-items-center mb-3">
				<div>
					<span class="text-muted">
						Hiển thị <strong th:text="${#lists.size(logs)}"></strong> trong tổng số <strong th:text="${totalCount}"></strong> bản ghi
					</span>
				</div>
			</div>

			<!-- Logs Table -->
			<div class="table-responsive">
				<table class="table table-hover">
				    <thead class="table-light">
				        <tr>
				            <th>Thời gian</th>
				            <th>Admin</th>
				            <th>Hành động</th>
				            <th>Chi tiết</th>
				        </tr>
				    </thead>
				    <tbody>
				        <tr th:each="log : ${logs}">
				            <td>
				            	<span th:text="${#temporals.format(log.timestamp, 'dd/MM/yyyy')}"></span><br>
				            	<small class="text-muted" th:text="${#temporals.format(log.timestamp, 'HH:mm:ss')}"></small>
				            </td>
				            <td>
				            	<span th:text="${log.admin}"></span>
				            </td>
				            <td>
				            	<span class="badge bg-primary" th:text="${log.action}"></span>
				            </td>
				            <td>
				                <div th:if="${#lists.size(log.detailsMap) > 0}">
				                    <span th:each="entry : ${log.detailsMap}">
				                        <b th:text="${entry.key + ':'}"></b>
				                        <span th:text="${entry.value}"></span><br/>
				                    </span>
				                </div>
				                <span th:unless="${#lists.size(log.detailsMap) > 0}" th:text="${log.details}"></span>
				            </td>
				        </tr>
				        <tr th:if="${#lists.isEmpty(logs)}">
				        	<td colspan="4" class="text-center text-muted py-4">
				        		<i class="bi bi-inbox fs-1 d-block mb-2"></i>
				        		Không có dữ liệu phù hợp với bộ lọc
				        	</td>
				        </tr>
				    </tbody>
				</table>
			</div>

			<!-- Pagination -->
			<nav th:if="${totalPages > 1}" aria-label="Admin logs pagination">
				<ul class="pagination justify-content-center">
					<!-- Previous button -->
					<li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
						<a class="page-link"
						   th:href="@{/admin/website-settings(page=${currentPage - 1}, size=${pageSize}, adminFilter=${adminFilter}, actionFilter=${actionFilter})}"
						   th:if="${currentPage > 1}">
							<i class="bi bi-chevron-left"></i> Trước
						</a>
						<span class="page-link" th:if="${currentPage == 1}">
							<i class="bi bi-chevron-left"></i> Trước
						</span>
					</li>

					<!-- Page numbers -->
					<li class="page-item"
					    th:each="pageNum : ${#numbers.sequence(T(java.lang.Math).max(1, currentPage - 2), T(java.lang.Math).min(totalPages, currentPage + 2))}"
					    th:classappend="${pageNum == currentPage} ? 'active'">
						<a class="page-link"
						   th:href="@{/admin/website-settings(page=${pageNum}, size=${pageSize}, adminFilter=${adminFilter}, actionFilter=${actionFilter})}"
						   th:text="${pageNum}"
						   th:if="${pageNum != currentPage}"></a>
						<span class="page-link" th:if="${pageNum == currentPage}" th:text="${pageNum}"></span>
					</li>

					<!-- Next button -->
					<li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
						<a class="page-link"
						   th:href="@{/admin/website-settings(page=${currentPage + 1}, size=${pageSize}, adminFilter=${adminFilter}, actionFilter=${actionFilter})}"
						   th:if="${currentPage < totalPages}">
							Sau <i class="bi bi-chevron-right"></i>
						</a>
						<span class="page-link" th:if="${currentPage == totalPages}">
							Sau <i class="bi bi-chevron-right"></i>
						</span>
					</li>
				</ul>
			</nav>

			<!-- Pagination Info -->
			<div class="text-center text-muted mt-3" th:if="${totalPages > 1}">
				Trang <strong th:text="${currentPage}"></strong> / <strong th:text="${totalPages}"></strong>
				(<strong th:text="${totalCount}"></strong> bản ghi)
			</div>
		</div>
		<!-- Page main content END -->
	</div>
	<!-- Page content END -->
	
	</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- Bootstrap JS -->
<script th:src="@{/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>

<!-- Vendor -->
<script th:src="@{/assets/vendor/overlay-scrollbar/js/overlayscrollbars.min.js}"></script>
<script th:src="@{/assets/vendor/flatpickr/js/flatpickr.min.js}"></script>

<!-- ThemeFunctions -->
<script th:src="@{/assets/js/functions.js}"></script>

<!-- Admin Settings and Log Filters Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Settings Form Change Detection
    const settingsForm = document.getElementById('settingsForm');
    const updateBtn = document.getElementById('updateBtn');
    const resetBtn = document.getElementById('resetBtn');
    const changeIndicator = document.getElementById('changeIndicator');

    // Get original values
    const originalValues = {
        siteName: document.getElementById('originalSiteName').value || '',
        supportEmail: document.getElementById('originalSupportEmail').value || '',
        contactPhone: document.getElementById('originalContactPhone').value || '',
        contactAddress: document.getElementById('originalContactAddress').value || ''
    };

    // Get form inputs
    const inputs = {
        siteName: document.getElementById('siteName'),
        supportEmail: document.getElementById('supportEmail'),
        contactPhone: document.getElementById('contactPhone'),
        contactAddress: document.getElementById('contactAddress')
    };

    // Function to normalize strings for comparison
    function normalizeString(str) {
        return (str || '').trim();
    }

    // Function to check if form has changes
    function hasChanges() {
        return normalizeString(inputs.siteName.value) !== normalizeString(originalValues.siteName) ||
               normalizeString(inputs.supportEmail.value) !== normalizeString(originalValues.supportEmail) ||
               normalizeString(inputs.contactPhone.value) !== normalizeString(originalValues.contactPhone) ||
               normalizeString(inputs.contactAddress.value) !== normalizeString(originalValues.contactAddress);
    }

    // Function to update UI based on changes
    function updateChangeIndicator() {
        const changed = hasChanges();
        updateBtn.disabled = !changed;
        changeIndicator.style.display = changed ? 'block' : 'none';

        if (changed) {
            updateBtn.classList.remove('btn-secondary');
            updateBtn.classList.add('btn-primary');
        } else {
            updateBtn.classList.remove('btn-primary');
            updateBtn.classList.add('btn-secondary');
        }
    }

    // Add event listeners to all form inputs
    Object.values(inputs).forEach(input => {
        if (input) {
            input.addEventListener('input', updateChangeIndicator);
            input.addEventListener('change', updateChangeIndicator);
        }
    });

    // Reset button functionality
    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            inputs.siteName.value = originalValues.siteName;
            inputs.supportEmail.value = originalValues.supportEmail;
            inputs.contactPhone.value = originalValues.contactPhone;
            inputs.contactAddress.value = originalValues.contactAddress;
            updateChangeIndicator();
        });
    }

    // Form submission validation
    if (settingsForm) {
        settingsForm.addEventListener('submit', function(e) {
            if (!hasChanges()) {
                e.preventDefault();
                alert('Không có thay đổi nào để cập nhật.');
                return false;
            }
        });
    }

    // Initial check
    updateChangeIndicator();

    // Auto-submit form when log filter inputs change
    const adminSelect = document.querySelector('select[name="adminFilter"]');
    const actionSelect = document.querySelector('select[name="actionFilter"]');
    const sizeSelect = document.querySelector('select[name="size"]');

    // Add change event listeners for auto-submit (only for filter form)
    [adminSelect, actionSelect, sizeSelect].forEach(element => {
        if (element) {
            element.addEventListener('change', function() {
                // Make sure this is not the settings form
                if (element.closest('form').id !== 'settingsForm') {
                    // Add a small delay to prevent rapid submissions
                    setTimeout(() => {
                        element.closest('form').submit();
                    }, 100);
                }
            });
        }
    });
});
</script>

</body>

<!-- Mirrored from stackbros.in/bookinga/landing/admin-settings.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:55 GMT -->
</html>