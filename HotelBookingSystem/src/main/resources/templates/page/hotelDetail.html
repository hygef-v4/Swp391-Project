<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:inline="text" lang="en">

<!-- Mirrored from stackbros.in/bookinga/landing/hotel-detail.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:06:45 GMT -->
<head>
	<title th:text="${hotel.hotelName}"></title>

	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="StackBros">
	<meta name="description" content="Booking - Multipurpose Online Booking Theme">
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

	<meta property="og:title" th:content="${hotel.hotelName}"/>
	<meta property="og:description" th:content="'Đặt phòng tại ' + ${hotel.hotelName} + ' trên Hamora Platform'"/>
	<meta property="og:url" th:content="${@environment.getProperty('app.base-url')} + '/hotel-detail?hotelId=' + ${hotel.hotelId}"/>
	<meta property="og:image" th:content="${hotel.hotelImageUrl}"/>
	<meta property="og:type" content="website"/>
	<meta property="og:site_name" content="Hamora Platform"/>
	<meta property="og:locale" content="vi_VN"/>

	<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:site" content="@HamoraPlatform"/>
	<meta name="twitter:creator" content="@HamoraPlatform"/>
	<meta name="twitter:title" th:content="${hotel.hotelName}"/>
	<meta name="twitter:description" th:content="'Đặt phòng tại ' + ${hotel.hotelName} + ' trên Hamora Platform'"/>
	<meta name="twitter:image" th:content="${hotel.hotelImageUrl}"/>

	<!-- Dark mode -->
	<script>
		const storedTheme = localStorage.getItem('theme')
 
		const getPreferredTheme = () => {
			if (storedTheme) {
				return storedTheme
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
		}

		const setTheme = function (theme) {
			if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
				document.documentElement.setAttribute('data-bs-theme', 'dark')
			} else {
				document.documentElement.setAttribute('data-bs-theme', theme)
			}
		}

		setTheme(getPreferredTheme())

		window.addEventListener('DOMContentLoaded', () => {
		    var el = document.querySelector('.theme-icon-active');
			if(el != 'undefined' && el != null) {
				const showActiveTheme = theme => {
				const activeThemeIcon = document.querySelector('.theme-icon-active use')
				const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
				const svgOfActiveBtn = btnToActive.querySelector('.mode-switch use').getAttribute('href')

				document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
					element.classList.remove('active')
				})

				btnToActive.classList.add('active')
				activeThemeIcon.setAttribute('href', svgOfActiveBtn)
			}

			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
				if (storedTheme !== 'light' || storedTheme !== 'dark') {
					setTheme(getPreferredTheme())
				}
			})

			showActiveTheme(getPreferredTheme())

			document.querySelectorAll('[data-bs-theme-value]')
				.forEach(toggle => {
					toggle.addEventListener('click', () => {
						const theme = toggle.getAttribute('data-bs-theme-value')
						localStorage.setItem('theme', theme)
						setTheme(theme)
						showActiveTheme(theme)
					})
				})

			}
		})
		
	</script>

	<script>
		let choices;

		document.addEventListener("DOMContentLoaded", function(){
			const items = document.querySelectorAll(".room-description li");
			items.forEach(li => {
				li.classList.add("list-group-item", "h6", "fw-light", "d-flex", "mb-0");

				const icon = document.createElement("i");
				icon.className = "fa-solid fa-check-circle text-success me-2";
				li.insertBefore(icon, li.firstChild);
			})

			var element = document.querySelector('.js-choice-review');

			var removeItemBtn = element.getAttribute('data-remove-item-button') == 'true' ? true : false;
			var placeHolder = element.getAttribute('data-placeholder') ? element.getAttribute('data-placeholder') : '';
			var placeHolderVal = element.getAttribute('data-placeholder-value') ? element.getAttribute('data-placeholder-value') : '';
			var maxItemCount = element.getAttribute('data-max-item-count') ? element.getAttribute('data-max-item-count') : 3;
			var searchEnabled = element.getAttribute('data-search-enabled') == 'true' ? true : false;

			choices = new Choices(element, {
				removeItemButton: removeItemBtn,
				placeholder: placeHolder,
				placeholderValue: placeHolderVal,
				maxItemCount: maxItemCount,
				searchEnabled: searchEnabled
			});
		});
	</script>

	<!-- Favicon -->
	<link rel="shortcut icon" href="assets/images/favicon.ico">

	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&amp;family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">

	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="assets/vendor/font-awesome/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/bootstrap-icons/bootstrap-icons.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/glightbox/css/glightbox.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/flatpickr/css/flatpickr.min.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/choices/css/choices.min.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/tiny-slider/tiny-slider.css">

	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">

</head>

<body>

<!-- Header START -->
<div th:replace="~{common/header :: header}"></div>
<!-- Header END -->

<!-- **************** MAIN CONTENT START **************** -->
<main>

<!-- =======================
Search START -->
<section class="py-3 py-sm-0">
	<div class="container">
		<!-- Offcanvas button for search -->
		<button class="btn btn-primary d-sm-none w-100 mb-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEditsearch" aria-controls="offcanvasEditsearch"><i class="bi bi-pencil-square me-2"></i>Edit Search</button>

		<!-- Search with offcanvas START -->
		<form th:action="@{/hotel-list}" method="GET"
				class="card shadow rounded-3 position-relative p-4 pe-md-5 pb-5 pb-md-4">
			<div class="row g-4 align-items-center">
				<!-- Location -->
				<div class="col-lg-4">
					<div class="form-control-border form-control-transparent form-fs-md d-flex">
						<!-- Icon -->
						<i class="bi bi-geo-alt fs-3 me-2 mt-2"></i>
						<!-- Select input -->
						<div class="flex-grow-1">
							<label class="form-label">Địa điểm</label>
							<select name="locationId" class="form-select js-choice"
									data-search-enabled="true">
								<option value="-1">Tất cả mọi nơi</option>
								<option
										th:each="location : ${locations}"
										th:value="${location.id}"
										th:text="${location.cityName}"
										th:selected="${location.id == hotel.locationId}"
								>
								</option>
							</select>
						</div>
					</div>
				</div>

				<!-- Check in -->
				<div class="col-lg-4">
					<div class="d-flex">
						<!-- Icon -->
						<i class="bi bi-calendar fs-3 me-2 mt-2"></i>
						<!-- Date input -->
						<div class="form-control-border form-control-transparent form-fs-md">
							<label class="form-label">Nhận phòng – Trả phòng</label>
							<input type="text" th:value="${dateRange}" class="form-control flatpickr" data-mode="range" name="dateRange" placeholder="Chọn ngày">
						</div>
					</div>
				</div>

				<!-- Guest -->
				<div class="col-lg-4">
					<div class="form-control-border form-control-transparent form-fs-md d-flex">
						<!-- Icon -->
						<i class="bi bi-person fs-3 me-2 mt-2"></i>
						<!-- Dropdown input -->
						<div class="w-100">
							<label class="form-label">Khách & Phòng</label>
							<div class="dropdown guest-selector me-2">
								<input readonly type="text" class="form-guest-selector form-control selection-result" th:value="${guests} + ' Khách ' + ${roomQuantity} + ' Phòng'" data-bs-auto-close="outside" data-bs-toggle="dropdown">

								<!-- dropdown items -->
								<ul class="dropdown-menu guest-selector-dropdown">
									<!-- Guest -->
									<li class="d-flex justify-content-between">
										<div>
											<h6 class="mb-0">Khách</h6>
										</div>

										<div class="hstack gap-1 align-items-center">
											<button type="button" th:class="'btn btn-link guest-remove p-0 mb-0' + ${guests == 1 ? ' disabled' : ''}">
												<i class="bi bi-dash-circle fs-5 fa-fw"></i>
											</button>
											<h6 class="guest-selector-count mb-0 guests" th:text="${guests}"></h6>
											<button type="button" th:class="'btn btn-link guest-add p-0 mb-0' + ${guests == 50 ? ' disabled' : ''}">
												<i class="bi bi-plus-circle fs-5 fa-fw"></i>
											</button>
										</div>
									</li>

									<!-- Divider -->
									<li class="dropdown-divider"></li>

									<!-- Rooms -->
									<li class="d-flex justify-content-between">
										<div>
											<h6 class="mb-0">Phòng</h6>
										</div>

										<div class="hstack gap-1 align-items-center">
											<button type="button" th:class="'btn btn-link room-remove p-0 mb-0' + ${roomQuantity == 1 ? ' disabled' : ''}">
												<i class="bi bi-dash-circle fs-5 fa-fw"></i>
											</button>
											<h6 class="guest-selector-count mb-0 rooms" th:text="${roomQuantity}"></h6>
											<button type="button" th:class="'btn btn-link room-add p-0 mb-0' + ${roomQuantity == 20 ? ' disabled' : ''}">
												<i class="bi bi-plus-circle fs-5 fa-fw"></i>
											</button>
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!--Hidden field for guests and rooms-->
			<input type="hidden" name="guests" id="guestsInput" th:value="${guests}">
			<input type="hidden" name="rooms" id="roomsInput" th:value="${roomQuantity}">


			<!-- Button -->
			<div class="btn-position-md-middle">
				<button type="submit" class="icon-lg btn btn-round btn-primary mb-0">
					<i class="bi bi-search fa-fw"></i>
				</button>
			</div>			
		</form>
		<!-- Search with offcanvas END -->
	</div>
</section>
<!-- =======================
Search END -->
	
<!-- =======================
Main Title START -->
	<div class="container mt-3">
		<!-- Thông báo khách sạn bị từ chối -->
		<div th:if="${hotel.status == 'rejected'}" class="alert alert-danger alert-dismissible fade show" role="alert" style="font-size:1.2rem;">
			<strong>Khách sạn này đã bị từ chối bởi quản trị viên và không thể đặt phòng!</strong>
		</div>
		<!-- Thông báo thành công -->
		<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
			<strong>Thành công!</strong> <span th:text="${successMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<!-- Thông báo lỗi -->
		<div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
			<strong>Lỗi!</strong> <span th:text="${errorMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<div th:if="${banMessage}" class="alert alert-danger alert-dismissible show" role="alert">
			<span th:text="${banMessage}"></span>
		</div>
	</div>

	<section class="py-0 pt-sm-5">
	<div class="container position-relative">
		<!-- Title and button START -->
		<div class="row mb-3">
			<div class="col-12">
				<!-- Meta -->
				<div class="d-lg-flex justify-content-lg-between mb-1">
					<!-- Title -->
					<div class="mb-2 mb-lg-0">
						<h1 class="fs-2" th:text="${hotel.hotelName}"></h1>
						<!-- Location -->
						<p class="fw-bold mb-0"><i class="bi bi-geo-alt me-2"></i>
							<span th:text="${hotel.address + ', ' + hotel.cityName}"></span>
							<a onclick="initMap()" class="ms-2 text-decoration-underline" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#mapmodal">
								<i class="bi bi-eye-fill me-1"></i>Xem Bản Đồ
							</a>
						</p>
					</div>

					<!-- Buttons -->
					<ul class="list-inline text-end">
						<!-- Heart icon -->
						<li class="list-inline-item">
							<form th:action="${(favorite ? 'remove-favorite' : '/add-favorite') + '?hotelId=' + hotel.hotelId + '&detail=true' + redirect}" method="post" style="display: inline;">
								<button type="submit" class="btn btn-sm btn-light px-2">
									<i th:class="'fa-solid fa-fw fa-heart' + ${favorite ? ' text-danger' : ''}"></i>
								</button>
							</form>
						</li>

						<!-- Share icon -->
						<li class="list-inline-item dropdown">
							<!-- Share button -->
							<a class="btn btn-sm btn-light px-2" role="button" id="dropdownShare" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="fa-solid fa-fw fa-share-alt"></i>
							</a>
							<!-- dropdown button -->
							<ul class="dropdown-menu dropdown-menu-end min-w-auto shadow rounded" aria-labelledby="dropdownShare">
								<li><a class="dropdown-item" th:href="'https://www.facebook.com/sharer/sharer.php?u=' + ${@environment.getProperty('app.base-url')} + '/hotel-detail?hotelId=' + ${hotel.hotelId}" target="_blank"><i class="fab fa-facebook-square me-2"></i>Facebook</a></li>
								<li><a class="dropdown-item" th:href="'https://twitter.com/intent/tweet?url=' + ${@environment.getProperty('app.base-url')} + '/hotel-detail?hotelId=' + ${hotel.hotelId}" target="_blank"><i class="fab fa-twitter-square me-2"></i>Twitter</a></li>
								<li><a class="dropdown-item" th:href="'hotel-detail?hotelId=' + ${hotel.hotelId}" onclick="event.preventDefault();navigator.clipboard.writeText(this.href)"><i class="fa-solid fa-copy me-2"></i>Copy link</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- Title and button END -->
	</div>
</section>
<!-- =======================
Main Title END -->

<!-- =======================
Image gallery START -->
<section class="card-grid pt-0">
	<div class="container">
		<div th:if="${!hotel.hotelImageUrl.isEmpty()}" class="row g-2">
			<!-- Image -->
			<div th:class="${rooms != null && rooms.size() > 0 && rooms.get(0).getImages() != null && !rooms.get(0).getImages().isEmpty() && !rooms.get(0).getImages().get(0).isEmpty()} ? 'col-md-6' : 'col-md-12'">
				<a data-glightbox="type: image" data-gallery="gallery" th:href="${hotel.hotelImageUrl}">
					<div class="card card-grid-lg card-element-hover card-overlay-hover overflow-hidden" th:style="'background-image:url(' + ${hotel.hotelImageUrl} + '); background-position: center left; background-size: cover;'">
						<!-- Card hover element -->
						<div class="hover-element position-absolute w-100 h-100">
							<i class="bi bi-fullscreen fs-6 text-white position-absolute top-50 start-50 translate-middle bg-dark rounded-1 p-2 lh-1"></i>
						</div>
					</div>
				</a>
			</div>

			<div th:if="${rooms != null && rooms.size() > 0 && rooms.get(0).getImages() != null && !rooms.get(0).getImages().isEmpty() && !rooms.get(0).getImages().get(0).isEmpty()}" class="col-md-6">
				<a th:if="${rooms.size() == 1 || !(rooms.get(1).getImages() != null && !rooms.get(1).getImages().isEmpty() && !rooms.get(1).getImages().get(0).isEmpty())}" data-glightbox="type: image" data-gallery="gallery" th:href="${rooms.get(0).getImages().get(0)}">
					<div class="card card-grid-lg card-element-hover card-overlay-hover overflow-hidden" th:style="'background-image:url(' + ${rooms.get(0).getImages().get(0)} + '); background-position: center left; background-size: cover;'">
						<!-- Card hover element -->
						<div class="hover-element position-absolute w-100 h-100">
							<i class="bi bi-fullscreen fs-6 text-white position-absolute top-50 start-50 translate-middle bg-dark rounded-1 p-2 lh-1"></i>
						</div>
					</div>
				</a>				
				<!-- Card item START -->
				<div th:if="${rooms.size() > 1 && rooms.get(1).getImages() != null && !rooms.get(1).getImages().isEmpty() && !rooms.get(1).getImages().get(0).isEmpty()}" class="row g-2">
					<!-- Image -->
					<div class="col-12">
						<a data-glightbox="type: image" data-gallery="gallery" th:href="${rooms.get(0).getImages().get(0)}">
							<div class="card card-grid-sm card-element-hover card-overlay-hover overflow-hidden" th:style="'background-image:url(' + ${rooms.get(0).getImages().get(0)} + '); background-position: center left; background-size: cover;'">
								<!-- Card hover element -->
								<div class="hover-element position-absolute w-100 h-100">
									<i class="bi bi-fullscreen fs-6 text-white position-absolute top-50 start-50 translate-middle bg-dark rounded-1 p-2 lh-1"></i>
								</div>
							</div>
						</a>	
					</div>

					<!-- Image -->
					<div th:class="${rooms.size() > 2 && rooms.get(2).getImages() != null && !rooms.get(2).getImages().isEmpty() && !rooms.get(2).getImages().get(0).isEmpty()} ? 'col-md-6' : 'col-md-12'">
						<a data-glightbox="type: image" data-gallery="gallery" th:href="${rooms.get(1).getImages().get(0)}">
							<div class="card card-grid-sm card-element-hover card-overlay-hover overflow-hidden" th:style="'background-image:url(' + ${rooms.get(1).getImages().get(0)} + '); background-position: center left; background-size: cover;'">
								<!-- Card hover element -->
								<div class="hover-element position-absolute w-100 h-100">
									<i class="bi bi-fullscreen fs-6 text-white position-absolute top-50 start-50 translate-middle bg-dark rounded-1 p-2 lh-1"></i>
								</div>
							</div>
						</a>	
					</div>

					<!-- Images -->
					<div th:if="${rooms.size() > 2 && rooms.get(2).getImages() != null && !rooms.get(2).getImages().isEmpty() && !rooms.get(2).getImages().get(0).isEmpty()}" class="col-md-6">
						<div class="card card-grid-sm overflow-hidden" th:style="'background-image:url(' + ${rooms.get(2).getImages().get(0)} + '); background-position: center left; background-size: cover;'">
							<!-- Popup Images -->
							<a data-glightbox="type: image" data-gallery="gallery" th:href="${rooms.get(2).getImages().get(0)}" class="stretched-link z-index-9"></a>
							<a th:each="room, i: ${rooms}" th:if="${i.index >= 3 && room.getImages() != null && !room.getImages().isEmpty() && !room.getImages().get(0).isEmpty()}" data-glightbox="type: image" data-gallery="gallery" th:href="${room.getImages().get(0)}"></a>
							
							<!-- Background overlay -->
							<div class="bg-overlay bg-dark opacity-7"></div>

							<!-- Overlay text -->
							<div class="card-img-overlay d-flex h-100 w-100">
								<h6 class="card-title m-auto fw-light text-decoration-underline"><a class="text-white">View all</a></h6>
							</div>
						</div>
					</div>
				</div>
				<!-- Card item END -->
			</div>
		</div>
	</div>
</section>
<!-- =======================
Image gallery END -->

<!-- =======================
About hotel START -->
<section class="pt-0">
	<div class="container" data-sticky-container>

		<div class="row g-4 g-xl-5">
			<!-- Content START -->
			<div class="col-xl-7 order-1">
				<div class="vstack gap-5">

					<!-- About hotel START -->
					<div class="card bg-transparent">
						<!-- Card header -->
						<div class="card-header border-bottom bg-transparent px-0 pt-0">
							<h3 class="mb-0">Giới thiệu về khách sạn</h3>
						</div>

						<!-- Card body START -->
						<div class="card-body pt-4 p-0">
							<p style="display: inline;" class="mb-3" th:utext="${short}"></p>
							<p class="my-3 collapse collapse-inline" id="collapseContent" th:utext="${long}"></p>
							<a class="p-0 mb-4 mt-2 btn-more d-flex align-items-center collapsed" data-bs-toggle="collapse" href="#collapseContent" role="button" aria-expanded="false" aria-controls="collapseContent" th:if="${!long.isEmpty()}">
								<span class="see-more ms-1">Xem thêm</span><span class="see-less ms-1">Ẩn bớt</span><i class="fa-solid fa-angle-down ms-2"></i>
							</a>
						</div>
						<!-- Card body END -->
					</div>
					<!-- About hotel START -->

					<!-- Hotel Policies START -->
					<div class="card bg-transparent">
						<!-- Card header -->
						<div class="card-header border-bottom bg-transparent px-0 pt-0">
							<h3 class="mb-0">Chính sách khách sạn</h3>
						</div>

						<!-- Card body START -->
						<div class="card-body pt-4 p-0">
							<!-- List -->
							<ul class="list-group list-group-borderless mb-2" th:utext="${hotel.policy}"></ul>
						</div>
						<!-- Card body END -->
					</div>
					<!-- Hotel Policies START -->

					<!-- Room START -->
					<div class="card bg-transparent" id="room-options">
						<!-- Card header -->
						<div class="card-header border-bottom bg-transparent px-0 pt-0">
							<div class="d-sm-flex justify-content-sm-between align-items-center">
								<h3 class="mb-2 mb-sm-0">Lựa Chọn Phòng</h3>
								<a th:class="'btn btn-sm btn-primary mb-0' + ${(rooms == null || rooms.size() == 0 || banMessage != null) ? ' disabled' : ''}" data-bs-toggle="modal" data-bs-target="#bookingModal">Chọn Phòng</a>  
							</div>
						</div>

						<!-- Card body START -->
						<div class="card-body pt-4 p-0">
							<div class="vstack gap-4">

								<!-- Room item START -->
								<div class="card shadow p-3" th:each="room: ${rooms}">
									<div class="row g-4">
										<!-- Card img -->
										<div class="col-md-5 position-relative d-flex flex-column justify-content-center">

											<!-- Slider START -->
											<div class="tiny-slider arrow-round arrow-xs arrow-dark overflow-hidden rounded-2">
												<div class="tiny-slider-inner" data-autoplay="true" data-arrow="true" data-dots="false" data-items="1">
													<!-- Image item -->
													<div class="text-center" th:each="image: ${room.images}">
														<a href="#" data-bs-toggle="modal" th:data-bs-target="'#roomDetail' + ${room.roomId}">
															<img style="max-height: 170px;" th:src="${image}" th:alt="${room.title}">
														</a>
													</div>
												</div>
											</div>
											<!-- Slider END -->
										</div>

										<!-- Card body -->
										<div class="col-md-7">
											<div class="card-body d-flex flex-column h-100 p-0">
					
												<!-- Title -->
												<h5 class="card-title"><a href="" th:text="${room.title}" data-bs-toggle="modal" th:data-bs-target="'#roomDetail' + ${room.roomId}"></a></h5>

												<ul class="list-group list-group-borderless mb-2 room-description" th:utext="${room.description}"></ul>

												<div class="d-flex justify-content-end align-items-center">
													<span>Số lượng: </span>
													<b th:class="'fw-bold mb-0 me-1' + ${room.quantity <= 0 ? ' text-danger' : ''}" th:text="${room.quantity}"></b>
												</div>                 

												<!-- Price and Button -->
												<div class="d-sm-flex justify-content-sm-between align-items-center mt-2">
													<!-- Button -->
													<div class="d-flex align-items-center">
														<h5 class="fw-bold mb-0 me-1" th:text="${#numbers.formatDecimal(room.price, 0, 'COMMA', 0, 'POINT')} + '₫'"></h5>
														<span class="mb-0 me-2">/Ngày</span>
													</div>
													<!-- Price -->
													<div class="mt-3 mt-sm-0">
														<a th:if="${hotel.status != 'rejected'}" th:class="'btn btn-sm btn-primary mb-0' + ${(room.quantity <= 0 || banMessage != null) ? ' disabled' : ''}" data-bs-toggle="modal" th:data-bs-target="'#bookingModal' + ${room.roomId}">Đặt Phòng</a>    
													</div>                  
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- Room item END -->

							</div>
						</div>
						<!-- Card body END -->
					</div>
					<!-- Room END -->

					<!-- Customer Review START -->
					<div class="card bg-transparent" id="hotel-reviews">
						<!-- Card header -->
						<div class="card-header border-bottom bg-transparent px-0 pt-0">
							<h3 class="card-title mb-0">Đánh Giá</h3>
						</div>

						<!-- Card body START -->
						<div class="card-body pt-4 p-0">
							<form class="mb-5" id="review">	
								<!-- Progress bar and rating START -->
								<div class="card bg-light p-4 mb-4">
									<div class="row g-4 align-items-center">
										<!-- Rating info -->
										<div th:if="${hotel.rating != 0}" class="col-md-4">
											<div class="text-center">
												<!-- Info -->
												<h2 class="mb-0" th:text="${hotel.rating}"></h2>
												<!-- Star -->
												<ul class="list-inline mb-0">
													<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 0.2} ? 'fa-regular fa-star' : (${hotel.rating >= 0.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
													<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 1.2} ? 'fa-regular fa-star' : (${hotel.rating >= 1.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
													<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 2.2} ? 'fa-regular fa-star' : (${hotel.rating >= 2.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
													<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 3.2} ? 'fa-regular fa-star' : (${hotel.rating >= 3.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
													<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 4.2} ? 'fa-regular fa-star' : (${hotel.rating >= 4.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
												</ul>
											</div>
										</div>

										<!-- Progress-bar START -->
										<div th:class="${hotel.rating == 0 ? 'col-md-12' : 'col-md-8'}">
											<div class="card-body p-0">
												<div th:if="${session.user != null}">
													<div id="reviewChat" th:class="'row gx-3 g-2 align-items-center' + ${review != null ? ' d-none' : ''}">
														<!-- Leave review START -->
														<input type="hidden" name="hotelId" th:value="${hotel.hotelId}">
														<input type="hidden" name="userId" th:value="${session.user.id}">
														<!-- Rating -->
														<div class="form-control-bg-light mb-3">
															<select name="rating" class="form-select js-choice-review">
																<option value="5" th:selected="${review != null ? (review.rating == 5 ? 'true' : 'false') : 'true'}">★★★★★ (5/5)</option>
																<option value="4" th:selected="${review != null ? (review.rating == 4 ? 'true' : 'false') : 'false'}">★★★★☆ (4/5)</option>
																<option value="3" th:selected="${review != null ? (review.rating == 3 ? 'true' : 'false') : 'false'}">★★★☆☆ (3/5)</option>
																<option value="2" th:selected="${review != null ? (review.rating == 2 ? 'true' : 'false') : 'false'}">★★☆☆☆ (2/5)</option>
																<option value="1" th:selected="${review != null ? (review.rating == 1 ? 'true' : 'false') : 'false'}">★☆☆☆☆ (1/5)</option>
															</select>
														</div>
														<!-- Message -->
														<div class="form-control-bg-light mb-3">
															<textarea name="comment" class="form-control" placeholder="Đánh giá về khách sạn" rows="3" th:text="${review != null ? review.comment : ''}"></textarea>
														</div>
														<!-- Button -->
														<div id="button">
															<button onclick="review(true)" type="button" class="btn btn-lg btn-primary mb-0 w-100" th:if="${review == null}">Gửi<i class="bi fa-fw bi-arrow-right ms-2"></i></button>
															<div class="form-control-bg-light mb-3 w-100 d-flex justify-content-center row" th:unless="${review == null}">
																<button onclick="closeReview()" type="button" class="btn btn-lg btn-danger mb-0 col-5 me-3">Quay lại</button>
																<button onclick="review(false)" type="button" class="btn btn-lg btn-primary mb-0 col-5">Sửa<i class="bi fa-fw bi-arrow-right ms-2"></i></button>
															</div>
														</div>
														<!-- Leave review END -->
													</div>
													<div id="reviewBox" th:class="'row gx-3 g-2 align-items-center' + ${review == null ? ' d-none' : ''}">
														<!-- Text -->
														<div class="w-100">
															<!-- Rating -->
															<div class="form-control-bg-light mb-3 d-flex justify-content-between">
																<div>
																	<h6 id="reviewName" class="me-3" th:text="${session.user.fullName}"></h6>
																	<!-- Info -->
																	<ul class="nav nav-divider small">
																		<li id="reviewDate" class="nav-item" th:text="${review == null ? '' : review.createdAt.format(T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy'))}"></li>
																	</ul>
																</div>
																<!-- Review star -->
																<div id="reviewRating" class="icon-md rounded text-bg-warning fs-6" th:text="${review == null ? '' : review.rating}"></div>
															</div>
															
															<p id="reviewComment" class="mb-3 comment" th:text="${review == null ? '' : review.comment}"></p>

															<!-- Button -->
															<div class="form-control-bg-light mb-3 d-flex justify-content-center row">
																<button onclick="deleteReview()" type="button" class="btn btn-lg btn-danger mb-0 col-5 me-3">Xóa</button>
																<button onclick="editReview()" type="button" class="btn btn-lg btn-primary mb-0 col-5">Chỉnh sửa</button>
															</div>
														</div>
													</div>
												</div>
												<div th:unless="${session.user != null}">
													<a href="/login" class="text-center">Đăng nhập hoặc đăng ký tài khoản để bình luận</a>
												</div>
												<!-- Row END -->
											</div>
										</div>
										<!-- Progress-bar END -->
									</div>
								</div>
							</form>
							<!-- Progress bar and rating END -->

							<!-- Review item START -->
							<div id="comment" style="max-width: 100%;">
								<div th:each="comment : ${comments}" th:id="'review' + ${comment.reviewId}">
									<div class="d-md-flex mt-4">
										<!-- Avatar -->
										<div class="avatar avatar-lg me-3 flex-shrink-0">
											<img class="avatar-img rounded-circle" th:src="${comment.avatarUrl != null ? comment.avatarUrl : '/assets/images/avatar/avatar.jpg'}" th:alt="${comment.fullName}">
										</div>
										<!-- Text -->
										<div class="w-100">
											<div class="d-flex justify-content-between mt-1 mt-md-0">
												<div>
													<h6 class="me-3 mb-0" th:text="${comment.fullName}"></h6>
													<!-- Info -->
													<ul class="nav nav-divider small mb-2">
														<li class="nav-item" th:text="${comment.createdAt.format(T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy'))}"></li>
													</ul>
												</div>
												<!-- Review star -->
												<div class="icon-md rounded text-bg-warning fs-6 rating" th:text="${comment.rating}"></div>
											</div>
											
											<p class="mb-0 comment" th:text="${comment.comment}"></p>

											<div class="d-flex justify-content-end mt-2" th:if="${session.user != null}">
												<div th:if="${comment.userId == session.user.id}">
													<a href="javascript:void(0)" class="text-secondary fw-bold hover-danger me-2" onclick="deleteReview()">Xóa</a>
													<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary me-2" onclick="editReview();scrollToId('review')">Chỉnh sửa</a>
												</div>
												<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary" th:onclick="'reply(' + ${comment.reviewId} + ',' + ${session.user.id} + ')'">Trả lời</a>
											</div>
										</div>
									</div>

									<!-- Child review START -->
									<div class="reply">
										<div class="ps-2 ps-md-3 mt-2" th:each="reply : ${comment.replies}" th:id="'reply' + ${reply.replyId}">
											<div class="d-md-flex">
												<img class="avatar avatar-sm rounded-circle me-3" th:src="${reply.avatarUrl != null ? reply.avatarUrl : '/assets/images/avatar/avatar.jpg'}" alt="avatar">
												<div class="mt-2 mt-md-0 w-100">
													<h6 class="mb-1" th:text="${reply.fullName}"></h6>
													<ul class="nav nav-divider small mb-2">
														<li class="nav-item" th:text="${reply.createdAt.format(T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy'))}"></li>
													</ul>

													<p class="mb-0 comment" th:text="${reply.comment}"></p>
													
													<div class="d-flex justify-content-end mt-2" th:if="${session.user != null}">
														<div th:if="${reply.userId == session.user.id}">
															<a href="javascript:void(0)" class="text-secondary fw-bold hover-danger me-2" th:onclick="'deleteReply(' + ${reply.replyId} + ')'">Xóa</a>
															<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary me-2" th:onclick="'editReply(' + ${reply.replyId} + ',' + ${comment.reviewId} + ');scrollToId(\'reply\');'">Chỉnh sửa</a>
														</div>
														<!-- <a href="javascript:void(0)" class="text-secondary fw-bold hover-primary" th:onclick="'reply(' + ${comment.reviewId} + ',' + ${session.user.id} + ');scrollToId(reply);'">Trả lời</a> -->
													</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Child review END -->
									
									<!-- Divider -->
									<hr>
								</div>
							</div>
							<!-- Review item END -->

							<!-- Button -->
							<!-- <div class="text-center">
								<a class="btn btn-primary-soft mb-0">Xem Thêm</a>
							</div> -->
						</div>
						<!-- Card body END -->
					</div>
					<!-- Customer Review END -->
				</div>	
			</div>
			<!-- Content END -->

			<!-- Right side content START -->
			<aside class="col-xl-5 order-xl-2">
				<div data-sticky data-margin-top="100" data-sticky-for="1199">
					<!-- Book now START -->
					<div class="card card-body border">
						<!-- Title -->
						<div class="d-sm-flex justify-content-sm-between align-items-center mb-3">
							<div>
								<span>Giá chỉ từ</span>
								<h4 class="card-title mb-0" th:text="${#numbers.formatDecimal(hotel.minPrice, 0, 'COMMA', 0, 'POINT')} + '₫'"></h4>
							</div>

							<!-- Heart icon -->
							<div class="list-inline-item">
								<form th:action="${(favorite ? 'remove-favorite' : '/add-favorite') + '?hotelId=' + hotel.hotelId + '&detail=true' + redirect}" method="post" style="display: inline;">
									<button type="submit" class="btn btn-sm btn-light px-2">
										<i th:class="'fa-solid fa-fw fa-heart' + ${favorite ? ' text-danger' : ''}"></i>
									</button>
								</form>
							</div>
						</div>		

						<!-- Rating -->
						<ul class="list-inline mb-2" th:if="${hotel.rating != 0}">
							<li class="list-inline-item me-1 h6 fw-light mb-0"><i class="bi bi-arrow-right me-2"></i><span th:text="${hotel.rating}"></span></li>
							<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 0.2} ? 'fa-regular fa-star' : (${hotel.rating >= 0.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
							<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 1.2} ? 'fa-regular fa-star' : (${hotel.rating >= 1.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
							<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 2.2} ? 'fa-regular fa-star' : (${hotel.rating >= 2.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
							<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 3.2} ? 'fa-regular fa-star' : (${hotel.rating >= 3.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
							<li class="list-inline-item me-0"><i th:class="(${hotel.rating <= 4.2} ? 'fa-regular fa-star' : (${hotel.rating >= 4.8} ? 'fa-solid fa-star' : 'fa-solid fa-star-half-alt')) + ' text-warning'"></i></li>
						</ul>

						<div class="list-inline mb-2" th:if="${hotel.rating == 0}">Chưa được đánh giá</div>

						<!-- Button -->
						<div class="d-grid">
							<!-- Ẩn nút đặt phòng nếu bị rejected -->
							<a th:if="${hotel.status != 'rejected'}" href="#room-options" class="btn btn-lg btn-primary-soft mb-0">Xem <span th:text="${rooms.size()}"></span> lựa chọn phòng</a>
						</div>

						<div class="d-grid mt-2">
							<a href="#hotel-reviews" class="btn btn-lg btn-secondary-soft mb-0">Đánh giá khách sạn</a>
						</div>
					</div>
					<!-- Book now END -->

				</div>	
			</aside>
			<!-- Right side content END -->
		</div> <!-- Row END -->
	</div>
</section>
<!-- =======================
About hotel END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- =======================
Footer START -->
<div th:replace="~{common/footer :: footer}"></div>
<!-- =======================
Footer END -->

<!-- Map modal START -->
<div class="modal fade" id="mapmodal" tabindex="-1" aria-labelledby="mapmodalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content">
			<!-- Title -->
			<div class="modal-header">
				<h5 class="modal-title" id="mapmodalLabel">Xem vị trí khách sạn</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<!-- Map -->
			<div class="modal-body p-0" id="map" style="height: 400px;border:0;"></div>
			<!-- Button -->
			<div class="modal-footer">
				<a th:href="${map}" target="_blank">
					<button type="button" class="btn btn-sm btn-primary mb-0"><i class="bi fa-fw bi-pin-map-fill me-2"></i>Mở Google Map</button>
				</a>
			</div>
		</div>
	</div>
</div>
<!-- Map modal END -->

<!-- Room modal START -->
<div class="modal fade" th:each="room: ${rooms}" th:id="'roomDetail' + ${room.roomId}" tabindex="-1" aria-labelledby="roomDetailLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content p-0">

			<!-- Title -->
			<div class="modal-header p-3">
				<h5 class="modal-title mb-0" id="roomDetailLabel">Chi tiết</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>

			<!-- Modal body -->
			<div class="modal-body p-0">

				<!-- Card START -->
				<div class="card bg-transparent p-3">
					<!-- Slider START -->
					<div class="tiny-slider arrow-round arrow-dark overflow-hidden rounded-2">
						<div class="tiny-slider-inner rounded-2 overflow-hidden" data-autoplay="true" data-arrow="true" data-dots="false" data-items="1">
							<!-- Image item -->
							<div th:each="image: ${room.images}"> <img th:src="${image}" class="rounded-2 img-fluid d-block mx-auto" style="max-height: 300px;" th:alt="${room.title}"></div>
						</div>
					</div>
					<!-- Slider END -->

					<!-- Card header -->
					<div class="card-header bg-transparent pb-0">
						<h5 class="card-title mb-0" th:text="${room.title}"></h5>
						<hr>
					</div>

					<!-- Card body START -->
					<div class="card-body pt-0">
						<!-- Content -->
						<ul class="list-group list-group-borderless mt-0 mb-2 room-description" th:utext="${room.description}"></ul>
						
						<div class="row">
							<h5 class="mb-0">Cơ sở vật chất</h5>
							<hr>

							<!-- List -->
							<div class="col-md-12" th:each="category: ${room.categories}">
								<h6 class="card-title mb-0" th:text="${category.name}"></h6>

								<!-- List -->
								<div style="column-count: 2; column-gap: 1.5rem;">
									<ul class="list-group list-group-borderless mt-2 mb-2">
										<li class="list-group-item d-flex mb-0" th:each="amenity: ${category.amenities}">
											<i class="fa-solid fa-thumbtack text-danger me-2"></i>
											<span class="h6 fw-light mb-0" th:text="${amenity.name}"></span>
										</li>
									</ul>
								</div>

								<hr>
							</div>

							<div class="d-flex justify-content-end align-items-center">
								<span>Số lượng: </span>
								<b th:class="'fw-bold mb-0 me-1' + ${room.quantity <= 0 ? ' text-danger' : ''}" th:text="${room.quantity}"></b>
							</div>    

							<div class="d-sm-flex justify-content-sm-between align-items-center mt-2 mb-0">
								<!-- Button -->
								<div class="d-flex align-items-center">
									<h5 class="fw-bold mb-0 me-1" th:text="${#numbers.formatDecimal(room.price, 0, 'COMMA', 0, 'POINT')} + '₫'"></h5>
									<span class="mb-0 me-2">/Ngày</span>
								</div>
								<!-- Price -->
								<div class="mt-3 mt-sm-0">
									<!-- Ẩn nút đặt phòng trong từng phòng nếu bị rejected -->
									<a th:if="${hotel.status != 'rejected'}" th:class="'btn btn-sm btn-primary mb-0' + ${(room.quantity <= 0 || banMessage != null) ? ' disabled' : ''}" data-bs-toggle="modal" th:data-bs-target="'#bookingModal' + ${room.roomId}">Chọn Phòng</a>    
								</div>                  
							</div>
						</div> <!-- Row END -->
					</div>
					<!-- Card body END -->
				</div>
				<!-- Card END -->
			</div>
		</div>
	</div>
</div>
<!-- Room modal END -->

<!-- Booking modal START -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-md">
		<div class="modal-content">
			<form th:action="@{/booking/{id}(id=${hotel.hotelId})}" onsubmit="return this.dateRange.value.trim() ? true : (this.querySelector('#error').classList.remove('hidden'), false)">
				<!-- Title -->
				<div class="modal-header">
					<h5 class="modal-title" id="bookingModalLabel">Chọn ngày đặt phòng</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<!-- Date Range -->
				<div class="modal-body p-0">                
					<!-- Check in -->
					<div class="col-10 mx-auto my-2">
						<div class="d-flex mb-2">
							<!-- Icon -->
							<i class="bi bi-calendar fs-3 me-2 mt-2"></i>
							<!-- Date input -->
							<div class="form-control-border form-control-transparent form-fs-md">
								<label class="form-label">Nhận phòng – Trả phòng</label>
								<input type="text" th:value="${dateRange}" class="form-control flatpickr" data-mode="range" name="dateRange" placeholder="Chọn ngày" required="true">
								<input type="hidden" th:value="${guests}" name="guests">
								<input type="hidden" th:value="${roomQuantity}" name="rooms">
							</div>
						</div>
					</div>                                                          
				</div>
				<!-- Button -->
				<div class="modal-footer">
					<div class="hidden" id="error" style="text-align:center; color:red;">Bạn phải chọn ngày đặt phòng</div>
					<input type="submit" class="btn btn-sm btn-primary mb-0" value="Đặt Phòng">
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" th:each="room: ${rooms}" th:id="'bookingModal' + ${room.roomId}" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-md">
		<div class="modal-content">
			<form th:action="@{/booking/{id}(id=${hotel.hotelId})}" onsubmit="return this.dateRange.value.trim() ? true : (this.querySelector('#error').classList.remove('hidden'), false)">
				<!-- Title -->
				<div class="modal-header">
					<h5 class="modal-title" id="bookingModalLabel">Chọn ngày đặt phòng</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<!-- Date Range -->
				<div class="modal-body p-0">                
					<!-- Check in -->
					<div class="col-10 mx-auto my-2">
						<div class="d-flex mb-2">
							<!-- Icon -->
							<i class="bi bi-calendar fs-3 me-2 mt-2"></i>
							<!-- Date input -->
							<div class="form-control-border form-control-transparent form-fs-md">
								<label class="form-label">Nhận phòng – Trả phòng</label>
								<input type="hidden" name="roomId" th:value="${room.roomId}">
								<input type="text" th:value="${dateRange}" class="form-control flatpickr" data-mode="range" name="dateRange" placeholder="Chọn ngày" required>
								<input type="hidden" th:value="${guests}" name="guests">
								<input type="hidden" th:value="${roomQuantity}" name="rooms">
							</div>
						</div>

						<div class="d-flex justify-content-between">
							<div>
								<span><b>Số phòng đặt: </b></span>
								<input class="bookedQuantity" type="number" name="amount" min="1" th:max="${room.quantity}" value="1" required="">
							</div>
							<div>
								<span>Còn: </span>
								<b class="fw-bold mb-0 me-1" th:text="${room.quantity}"></b>
							</div>
						</div>
					</div>
				</div>
				<!-- Button -->
				<div class="modal-footer">
					<div class="hidden" id="error" style="text-align:center; color:red;">Bạn phải chọn ngày đặt phòng</div>
					<input type="submit" class="btn btn-sm btn-primary mb-0" value="Đặt Phòng">
				</div>
			</form>
		</div>
	</div>
</div>
<!-- Bookinng modal END -->

<!-- Back to top -->
<div class="back-top"></div>

<!-- Bootstrap JS -->
<script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<!-- Vendors -->
<script src="assets/vendor/glightbox/js/glightbox.js"></script>
<script src="assets/vendor/flatpickr/js/flatpickr.min.js"></script>
<script src="assets/vendor/choices/js/choices.min.js"></script>
<script src="assets/vendor/tiny-slider/tiny-slider.js"></script>
<script src="assets/vendor/sticky-js/sticky.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/somanchiu/Keyless-Google-Maps-API@v7.0/mapsJavaScriptAPI.js" async defer></script>

<script th:inline="javascript">
	var map;

	var lat = /*[[${hotel.latitude}]]*/ 0;
	var lng = /*[[${hotel.longitude}]]*/ 0;

	function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: lat, lng: lng},
            zoom: 19
        });

        new google.maps.Marker({
			position: {lat: lat, lng: lng},
			map: map,
			icon: {
                url: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
                scaledSize: new google.maps.Size(20, 30)
            }
		});
	}
</script>

<!-- ThemeFunctions -->
<script src="assets/js/functions.js"></script>

<script>
	async function review(add = true){
		const form = document.getElementById('review');
		const formData = new FormData(form);

		const comment = formData.get('comment').trim();
		if(/<.*?>/.test(comment)){
			alert("Không thể gửi tin nhắn");
			return;
		}

		let chat = document.getElementById("reviewChat");
		let box = document.getElementById("reviewBox");

		// Lấy CSRF từ meta tag
		const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
		const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

		let request = await fetch('/review', {
			method: 'POST',
			headers: {
				[csrfHeader]: csrfToken
			},
			body: formData
		});

		let date = box.querySelector("#reviewDate");
		let rating = box.querySelector("#reviewRating");
		let review = box.querySelector("#reviewComment");

		if(add) date.textContent = new Date().toLocaleDateString('vi-VN');
		rating.textContent = formData.get('rating');
		review.textContent = formData.get('comment');

		chat.classList.add("d-none");
		if(add){
			document.getElementById("button").innerHTML = `
					<div class="form-control-bg-light mb-3 w-100 d-flex justify-content-center row">
						<button onclick="closeReview()" type="button" class="btn btn-lg btn-danger mb-0 col-5 me-3">Quay lại</button>
						<button onclick="review(false)" type="button" class="btn btn-lg btn-primary mb-0 col-5">Sửa<i class="bi fa-fw bi-arrow-right ms-2"></i></button>
					</div>
				`;
		}box.classList.remove("d-none");

		let response = await request.json();

		if(add){
			let r = `
					<div id="review${response.reviewId}">
						<div class="d-md-flex my-4">
							<div class="avatar avatar-lg me-3 flex-shrink-0">
								<img class="avatar-img rounded-circle" src="${response.avatarUrl ? response.avatarUrl : '/assets/images/avatar/avatar.jpg'}" alt="${response.fullName}">
							</div>
							<div class="w-100">
								<div class="d-flex justify-content-between mt-1 mt-md-0">
									<div>
										<h6 class="me-3 mb-0">${response.fullName}</h6>
										<ul class="nav nav-divider small mb-2">
											<li class="nav-item">${new Date(response.createdAt).toLocaleDateString('vi-VN')}</li>
										</ul>
									</div>
									<div class="icon-md rounded text-bg-warning fs-6 rating">${response.rating}</div>
								</div>
								<p class="mb-0 comment">${response.comment}</p>
								<div class="d-flex justify-content-end mt-2">
									<div>
										<a href="javascript:void(0)" class="text-secondary fw-bold hover-danger me-2" onclick="deleteReview()">Xóa</a>
										<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary me-2" onclick="editReview();scrollToId('review')">Chỉnh sửa</a>
									</div>
									<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary" onclick="reply(${response.reviewId},${response.userId})">Trả lời</a>
								</div>
							</div>
						</div>
						<hr>
					</div>
				`;

			let comment = document.getElementById("comment");
			comment.innerHTML = r + comment.innerHTML;
		}else{
			let r = document.querySelector("#review" + response.reviewId);
			if(r) {
				r.querySelector(".rating").textContent = response.rating;
				r.querySelector(".comment").textContent = response.comment;
			}
		}
	}

	function closeReview(){
		const form = document.getElementById('review');

		let chat = document.getElementById("reviewChat");
		let box = document.getElementById("reviewBox");

		let rating = box.querySelector("#reviewRating");
		let comment = box.querySelector("#reviewComment");

		choices.setChoiceByValue(rating.textContent);
		form.elements['comment'].value = comment.textContent;

		chat.classList.add("d-none");
		box.classList.remove("d-none");
	}

	async function editReview() {
		let chat = document.getElementById("reviewChat");
		let box = document.getElementById("reviewBox");

		chat.classList.remove("d-none");
		box.classList.add("d-none");
	}

	async function deleteReview() {
		const form = document.getElementById('review');
		const formData = new FormData(form);

		let chat = document.getElementById("reviewChat");
		let box = document.getElementById("reviewBox");

		// Lấy CSRF từ meta tag
		const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
		const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

		let request = await fetch('/deleteReview', {
			method: 'POST',
			headers: {
				[csrfHeader]: csrfToken
			},
			body: formData
		});

		box.querySelector("#reviewDate").textContent = "";
		choices.setChoiceByValue('5');
		form.elements['comment'].value = "";

		document.getElementById("button").innerHTML = '<button onclick="review()" type="button" class="btn btn-lg btn-primary mb-0 w-100">Gửi<i class="bi fa-fw bi-arrow-right ms-2"></i></button>';

		chat.classList.remove("d-none");
		box.classList.add("d-none");

		let response = await request.text()
		document.querySelector("#review" + response)?.remove();
	}

	function reply(reviewId, userId, edit = ""){
		let reply = document.getElementById("reply");
		if(reply){
			reply.remove();
			if(reply.elements["reviewId"].value == reviewId)
				return;
		}

		let form =`
			<form class="mb-5" id="reply">
				<div class="d-md-flex mt-4">
					<!-- Avatar -->
					<div class="avatar avatar-lg me-3 flex-shrink-0">
						<div class="avatar-img rounded-circle"></div>
					</div>
					<!-- Text -->
					<div class="w-100">
						<div class="row gx-3 g-2 align-items-center}">
							<!-- Leave reply START -->
							<input type="hidden" name="reviewId" value="${reviewId}">
							<input type="hidden" name="userId" value="${userId}">
							<!-- Message -->
							<div class="form-control-bg-light mb-3">
								<textarea name="comment" class="form-control" placeholder="Viết bình luận" rows="3">${edit}</textarea>
							</div>
							<!-- Button -->
							<button onclick="addReply()" type="button" class="btn btn-lg btn-primary mb-0">Gửi<i class="bi fa-fw bi-arrow-right ms-2"></i></button>
							<!-- Leave reply END -->
						</div>
					</div>
				</div>
			</form>
		`;

		let review = document.getElementById("review" + reviewId).querySelector(".reply");
		review.innerHTML = form + review.innerHTML;
	}

	async function addReply(add = true){
		const form = document.getElementById('reply');
		const formData = new FormData(form);

		if(!formData.get('comment').trim()) {
			alert("Vui lòng nhập bình luận.");
			return;
		}if(/<.*?>/.test(comment)){
			alert("Không thể gửi tin nhắn");
			return;
		}

		// Lấy CSRF từ meta tag
		const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
		const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

		if(add){
			let request = await fetch('/addReply', {
				method: 'POST',
				headers: {
					[csrfHeader]: csrfToken
				},
				body: formData
			});

			form.remove();

			let response = await request.json();

			let r = `
				<div class="ps-2 ps-md-3 mb-2" id="reply${response.replyId}">
					<div class="d-md-flex">
						<img class="avatar avatar-sm rounded-circle me-3" src="${response.avatarUrl}" alt="avatar">
						<div class="mt-2 mt-md-0 w-100">
							<h6 class="mb-1">${response.fullName}</h6>
							<ul class="nav nav-divider small mb-2">
								<li class="nav-item">${new Date(response.createdAt).toLocaleDateString('vi-VN')}</li>
							</ul>
							<p class="mb-0 comment">${response.comment}</p>
							<div class="d-flex justify-content-end mt-2">
								<div>
									<a href="javascript:void(0)" class="text-secondary fw-bold hover-danger me-2" onclick="deleteReply(${response.replyId})">Xóa</a>
									<a href="javascript:void(0)" class="text-secondary fw-bold hover-primary me-2" onclick="editReply(${response.replyId},${response.reviewId});scrollToId('reply');">Chỉnh sửa</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			`;

			let review = document.getElementById("review" + form.elements["reviewId"].value).querySelector(".reply");
			review.innerHTML = review.innerHTML + r;
		}else{
			let request = await fetch('/editReply', {
				method: 'POST',
				headers: {
					[csrfHeader]: csrfToken
				},
				body: formData
			});

			form.remove();

			let response = await request.json();

			let r = document.querySelector("#reply" + response.replyId);
			if(r){
				r.querySelector(".comment").textContent = response.comment;
			}
		}
	}

	function closeReply(){
		const form = document.getElementById('reply');
		form.remove();
	}

	function editReply(replyId, reviewId){
		let reply = document.getElementById("reply");
		if(reply){
			reply.remove();
			if(reply.elements["reviewId"].value == reviewId)
				return;
		}

		let r = document.getElementById("reply" + replyId);
		let comment = r.querySelector(".comment").textContent;
	
		let form =`
			<form class="mb-5" id="reply">
				<div class="d-md-flex mt-4">
					<!-- Avatar -->
					<div class="avatar avatar-lg me-3 flex-shrink-0">
						<div class="avatar-img rounded-circle"></div>
					</div>
					<!-- Text -->
					<div class="w-100">
						<div class="row gx-3 g-2 align-items-center}">
							<!-- Leave reply START -->
							<input type="hidden" name="replyId" value="${replyId}">
							<!-- Message -->
							<div class="form-control-bg-light mb-3">
								<textarea name="comment" class="form-control" placeholder="Viết bình luận" rows="3">${comment}</textarea>
							</div>
							<!-- Button -->
							<div class="form-control-bg-light mb-3 w-100 d-flex justify-content-center row">
								<button onclick="closeReply()" type="button" class="btn btn-lg btn-danger mb-0 col-5 me-3">Quay lại</button>
								<button onclick="addReply(false)" type="button" class="btn btn-lg btn-primary mb-0 col-5">Sửa<i class="bi fa-fw bi-arrow-right ms-2"></i></button>
							</div>
							<!-- Leave reply END -->
						</div>
					</div>
				</div>
			</form>
		`;

		let review = document.getElementById("review" + reviewId).querySelector(".reply");
		review.innerHTML = form + review.innerHTML;
	}

	async function deleteReply(replyId) {
		let reply = document.getElementById("reply");
		if(reply){
			reply.remove();
		}

		// Lấy CSRF từ meta tag
		const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
		const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

		let request = await fetch('/deleteReply', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
				[csrfHeader]: csrfToken
			},
			body: "replyId=" + replyId
		});

		let response = await request.text()
		document.querySelector("#reply" + response).remove();
	}
</script>

</body>

<!-- Mirrored from stackbros.in/bookinga/landing/hotel-detail.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:06:47 GMT -->
</html>