<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from stackbros.in/bookinga/landing/account-payment-details.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:33 GMT -->
<head>
	<title>Thông tin tài khoản ngân hàng</title>

	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="StackBros">
	<meta name="description" content="Thông tin tài khoản ngân hàng">

	<!-- Dark mode -->
	<script>
		const storedTheme = localStorage.getItem('theme')
 
		const getPreferredTheme = () => {
			if (storedTheme) {
				return storedTheme
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
		}

		const setTheme = function (theme) {
			if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
				document.documentElement.setAttribute('data-bs-theme', 'dark')
			} else {
				document.documentElement.setAttribute('data-bs-theme', theme)
			}
		}

		setTheme(getPreferredTheme())

		window.addEventListener('DOMContentLoaded', () => {
		    var el = document.querySelector('.theme-icon-active');
			if(el != 'undefined' && el != null) {
				const showActiveTheme = theme => {
				const activeThemeIcon = document.querySelector('.theme-icon-active use')
				const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
				const svgOfActiveBtn = btnToActive.querySelector('.mode-switch use').getAttribute('href')

				document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
					element.classList.remove('active')
				})

				btnToActive.classList.add('active')
				activeThemeIcon.setAttribute('href', svgOfActiveBtn)
			}

			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
				if (storedTheme !== 'light' || storedTheme !== 'dark') {
					setTheme(getPreferredTheme())
				}
			})

			showActiveTheme(getPreferredTheme())

			document.querySelectorAll('[data-bs-theme-value]')
				.forEach(toggle => {
					toggle.addEventListener('click', () => {
						const theme = toggle.getAttribute('data-bs-theme-value')
						localStorage.setItem('theme', theme)
						setTheme(theme)
						showActiveTheme(theme)
					})
				})

			}
		})
		
		window.addEventListener('DOMContentLoaded', () => {
			document.querySelectorAll('.tom-select').forEach(e => {
				console.log(e);
				new TomSelect(e, {
					render: {
					option: function(data, escape) {
						return `<div><img src="${data.icon}" style="height:20px;margin-right:8px;">${escape(data.text)}</div>`;
					},
					item: function(data, escape) {
						return `<div><img src="${data.icon}" style="height:20px;margin-right:8px;">${escape(data.text)}</div>`;
					}
					}
				});
			});
		})
	</script>

	<!-- Favicon -->
	<link rel="shortcut icon" href="assets/images/favicon.ico">

	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&amp;family=Poppins:wght@400;500;700&amp;display=swap">

	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="assets/vendor/font-awesome/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="assets/vendor/bootstrap-icons/bootstrap-icons.css">
	<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">

	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">

</head>

<body class="dashboard">

<!-- Header START -->
<div th:replace="~{common/header :: header}"></div>
<!-- Header END -->

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
<!-- =======================
Content START -->
<section class="pt-3">
	<div class="container">
		<div class="row g-2 g-lg-4">

			<!-- Sidebar START -->
			<div th:replace="~{common/sidebar-profile :: sidebar}"></div>
			<!-- Sidebar END -->

			<!-- Main content START -->
			<div class="col-lg-8 col-xl-9 ps-xl-5">

				<!-- Offcanvas menu button -->
				<div class="d-grid mb-0 d-lg-none w-100">
					<button class="btn btn-primary mb-4" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
						<i class="fas fa-sliders-h"></i> Menu
					</button>
				</div>

				<div class="container mt-3">
					<!-- Hotel Registration Redirect Message -->
					<div th:if="${hotelRegistrationRedirect}" class="alert alert-info border-start border-4 border-primary bg-light shadow-sm mb-4" role="alert" style="border-left-color: #0d6efd !important;">
						<div class="d-flex align-items-start">
							<div class="flex-shrink-0 me-3">
								<div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
									<i class="bi bi-wallet text-white fs-5"></i>
								</div>
							</div>
							<div class="flex-grow-1">
								<h5 class="alert-heading text-primary mb-2">
									<i class="bi bi-building me-2"></i>Thêm thông tin thanh toán để đăng ký khách sạn
								</h5>
								<p class="mb-3 text-dark" style="line-height: 1.6;">
									Để nhận thanh toán từ khách hàng khi đăng ký khách sạn, bạn cần thêm ít nhất một tài khoản ngân hàng.
								</p>
								<div class="bg-white p-3 rounded border">
									<small class="text-muted">
										<i class="bi bi-info-circle me-1"></i>
										Sau khi thêm thông tin thanh toán, bạn sẽ được chuyển về trang đăng ký khách sạn tự động.
									</small>
								</div>
							</div>
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					</div>

					<!-- Thông báo thành công -->
					<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
						<strong>Thành công!</strong> <span th:text="${successMessage}"></span>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

					<!-- Thông báo lỗi -->
					<div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
						<strong>Lỗi!</strong> <span th:text="${errorMessage}"></span>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				</div>

				<!-- Payment detail START -->
				<div class="card bg-transparent border">
					<!-- Card header -->
					<div class="card-header bg-transparent border-bottom d-flex justify-content-between">
						<h4 class="card-header-title">Thông tin thanh toán</h4>
						<a class="btn btn-primary" onclick="addBank()"><i class="bi bi-credit-card-2-front-fill me-2 fw-icon"></i>Thêm tài khoản</a>
					</div>

					<!-- Card body START -->
					<div class="card-body p-2 p-sm-4">
						<h5>Tài khoản ngân hàng đã lưu</h5>
						<div class="row g-4 mb-2">
							<!-- Visa card -->
							<div class="col-md-6" th:each="bank: ${user.banks}" id="${bank.bankNumber} + 'bank' + ${bank.bankId}">
								<div class="card">
									<div th:class="${bank.backGround()} + ' p-4 rounded-3 mb-2'" th:if="user != null">
										<div class="d-flex justify-content-between align-items-start">
											<div>
												<span style="background-color: white; display: inline-block; height: 30px"><img class="w-80px" th:src="${bank.logo}" th:alt="${bank.bankCode}"></span>
												<p class="mt-2 mb-2" style="color: white; font-weight: 700; font-size: large;" th:text="${bank.userName}"></p>
											</div>
											<!-- Card action START -->
											<div class="dropdown">
												<a class="text-white" href="#" id="creditcardDropdown" role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
													<!-- Dropdown Icon -->
													<svg width="24" height="24" fill="none">
														<circle fill="currentColor" cx="12.5" cy="3.5" r="2.5"></circle>
														<circle fill="currentColor" opacity="0.5" cx="12.5" cy="11.5" r="2.5"></circle>
														<circle fill="currentColor" opacity="0.3" cx="12.5" cy="19.5" r="2.5"></circle>
													</svg>
												</a>               
												<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="creditcardDropdown">
													<li><a class="dropdown-item" href="javascript:void(0)" th:attr="data-bank-id=${bank.bankId}, data-bank-code=${bank.bankCode}, data-bank-number=${bank.bankNumber}, data-user-name=${bank.userName}" onclick="editBank(this)"><i class="bi bi-calculator me-2 fw-icon"></i>Sửa thông tin</a></li>
													<li>
														<form action="/delete-bank" method="POST">
															<input type="hidden" name="bankId" th:value="${bank.bankId}">
															<input type="hidden" name="bankNumber" th:value="${bank.bankNumber}">
															<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
															<button type="submit" class="dropdown-item text-danger"><i class="bi bi-trash me-2 fw-icon"></i>Xóa tài khoản</button>
														</form>
													</li>
												</ul>
											</div>
											<!-- Card action END -->
										</div>
										<div onmouseover="unmask(this)" onmouseout="mask(this)">
											<h4 class="text-white masked" th:text="${bank.maskedCode()}"></h4>
											<h4 class="text-white hidden unmasked" th:text="${bank.bankNumber}"></h4>							
										</div>
										<div class="form-check form-switch form-check-md d-flex justify-content-end text-white">
											<label class="form-check-label ps-0 pe-2 fw-bold fs-6" th:for="'default' + ${bank.bankId}">Mặc định</label>
											<input class="form-check-input flex-shrink-0 default" type="checkbox" th:id="'default' + ${bank.bankId}" th:checked="${bank.defaultAccount}" th:attr="data-bank-id=${bank.bankId}, data-bank-number=${bank.bankNumber}" onchange="changeDefault(this)">
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Add new card START -->
						<div class="card border mt-4 hidden" id="addInfo">
							<div class="card-header border-bottom">
								<h5 class="card-header-title">Thông tin tài khoản</h5>
							</div>
							
							<div class="card-body">
								<form action="/add-bank" method="POST" class="row text-start g-4" id="addForm">
									<!-- Bank -->
									<div class="col-12">
										<label class="form-label">Ngân Hàng<span class="text-danger">*</span></label>
										<div class="position-relative">
											<select name="bankCode" class="form-control tom-select" required onchange="validate('add')">
												<option value="" disabled selected hidden>Chọn ngân hàng</option>
												<option th:each="bank : ${banks}" 
														th:value="${bank.bankCode}"
														th:data-icon="${bank.icon}"
														th:text="${bank.bankName} + ' (' + ${bank.bankCode} + ')'"
												>
												</option>
											</select>
										</div>	
									</div>
									<!-- Bank Account -->
									<div class="col-md-12">
										<label class="form-label">Số Tài Khoản<span class="text-danger">*</span></label>
										<input type="text" name="bankNumber" class="form-control" minlength="8" maxlength="16" placeholder="Số tài khoản" required onchange="validate('add')">
									</div>
									<!-- Account name -->
									<div class="col-12">
										<label class="form-label">Tên Người Dùng<span class="text-danger">*</span></label>
										<div class="input-group">
											<input type="text" name="userName" class="form-control bg-white" placeholder="Tên người dùng" required readonly onfocus="search('add')">
											<button type="button" class="btn btn-primary" onclick="search('add')">Tìm tài khoản</button>
										</div>
									</div>
									<!-- Button -->
									<div class="col-12 d-flex justify-content-end">
										<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
										<button class="btn btn-primary mb-0">Thêm tài khoản</button>
									</div>
								</form>
							</div>
						</div>
						<!-- Add new card END -->

						<!-- Edit old card START -->
						<div class="card border mt-4 hidden" id="editInfo">
							<div class="card-header border-bottom">
								<h5 class="card-header-title">Thông tin tài khoản</h5>
							</div>
							
							<div class="card-body">
								<form action="/edit-bank" method="POST" class="row text-start g-4" id="editForm">
									<!-- Bank -->
									<div class="col-12">
										<label class="form-label">Ngân Hàng<span class="text-danger">*</span></label>
										<div class="position-relative">
											<select name="bankCode" class="form-control tom-select" required onchange="validate('edit')">
												<option value="" disabled selected hidden>Chọn ngân hàng</option>
												<option th:each="bank : ${banks}" 
														th:value="${bank.bankCode}"
														th:data-icon="${bank.icon}"
														th:text="${bank.bankName} + ' (' + ${bank.bankCode} + ')'"
												>
												</option>
											</select>
										</div>	
									</div>
									<!-- Bank Account -->
									<div class="col-md-12">
										<label class="form-label">Số Tài Khoản<span class="text-danger">*</span></label>
										<input type="text" name="bankNumber" class="form-control" minlength="8" maxlength="16" placeholder="Số tài khoản" required onchange="validate('edit')">
									</div>
									<!-- Account name -->
									<div class="col-12">
										<label class="form-label">Tên Người Dùng<span class="text-danger">*</span></label>
										<div class="input-group">
											<input type="text" name="userName" class="form-control bg-white" placeholder="Tên người dùng" required readonly onfocus="search('edit')">
											<button type="button" class="btn btn-primary" onclick="search('edit')">Tìm tài khoản</button>
										</div>
									</div>
									<!-- Button -->
									<div class="col-12 d-flex justify-content-end">
										<input type="hidden" name="oldId">
										<input type="hidden" name="oldNumber">
										<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
										<button class="btn btn-primary mb-0">Sửa thông tin</button>
									</div>
								</form>
							</div>
						</div>
						<!-- Edit old card END -->

					</div>
					<!-- Card body END -->
				</div>
				<!-- Payment detail END -->

			</div>
			<!-- Main content END -->
		</div>
	</div>
</section>
<!-- =======================
Content END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- =======================
Footer START -->
<div th:replace="~{common/footer :: footer}"></div>
<!-- =======================
Footer END -->

<!-- Back to top -->
<div class="back-top"></div>

<!-- Bootstrap JS -->
<script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>

<!-- ThemeFunctions -->
<script src="assets/js/functions.js"></script>

<script>
	let addValidate = true;
	let editValidate = true;

	function validate(e){
		const form = document.getElementById(e + 'Form');
		form.elements['userName'].classList.remove('border');
		form.elements['userName'].classList.remove('border-danger');

		if(e == 'add') addValidate = false;
		else if(e == 'edit') editValidate = false;
	}

	async function search(e){
		if(e == 'add' && addValidate) return;
		if(e == 'edit' && editValidate) return;

		const form = document.getElementById(e + 'Form');

		let bankCode = form.elements['bankCode'].value;
		let bankNumber = form.elements['bankNumber'].value;
		if(bankCode.trim() == '' || bankNumber.trim() == ''){
			form.elements['userName'].value = "Vui lòng điền đầy đủ thông tin!!!"
		}else{
			form.elements['userName'].value = "Đang tìm kiếm..."
		}

		let request = await fetch('https://api.banklookup.net', {
			method: 'POST',
			headers: {
				'x-api-key': '2cabc90a-21cd-4266-bd71-757804d0ea81key',
				'x-api-secret': '378a3059-6be3-4f93-ae87-38c81df2c1b7secret',
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({
				'bank': bankCode,
				'account': bankNumber
			})
		});

		let response = await request.json();

		if(response.code == 200){
			form.elements['userName'].value = response.data.ownerName;

			if(e == 'add') addValidate = true;
			else if(e == 'edit') editValidate = true;
		}else{
			switch(response.code){
				case 422:
					form.elements['userName'].value = "Không tìm thấy tài khoản, vui lòng xác nhận lại thông tin tài khoản";
					break;

				case 429:
					form.elements['userName'].value = "Yêu cầu không phản hồi, vui lòng chờ vài phút";
					break;
				
				default:
					form.elements['userName'].value = "Xảy ra lỗi không xác định";
					break;
			}
			
			form.elements['userName'].classList.add('border');
			form.elements['userName'].classList.add('border-danger');
		}
	}

	document.getElementById('addForm').addEventListener('submit', async function(e){
		e.preventDefault();
		if(addValidate) this.submit();
		else{
			await search('add');
			if(addValidate) this.submit();
		}
	});

	document.getElementById('editForm').addEventListener('submit', async function(e){
		e.preventDefault();
		if(editValidate) this.submit();
		else{
			await search('edit');
			if(editValidate) this.submit();
		}
	});
</script>

<script>
	function unmask(e){
		e.querySelector(".masked").classList.add("hidden");
		e.querySelector(".unmasked").classList.remove("hidden");
	}

	function mask(e){
		e.querySelector(".unmasked").classList.add("hidden");
		e.querySelector(".masked").classList.remove("hidden");
	}

	async function changeDefault(e){
		if(e.checked == false){
			e.checked = true;
			return;
		}

		const id = e.getAttribute("data-bank-id");
		const number = e.getAttribute("data-bank-number");
		const bank = document.getElementById(number + 'bank' + id);

		let params = new URLSearchParams();
		params.append("bankId", id);
		params.append("bankNumber", number);

		let request = await fetch('/change-default', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded'
			},
			body: params
		});

		let response = await request.text();
		if(response == "ok"){
			document.querySelectorAll(".default").forEach(d => {
				if(d != e) d.checked = false;
			});
		}else{
			e.checked = false;
		}
	}
</script>

<script>
	let currentEdit;

	function addBank(){
		document.querySelector("#editInfo").classList.add("hidden");
		currentEdit = null;

		let addInfo = document.querySelector("#addInfo");

		if(addInfo.classList.contains("hidden")){
			addInfo.classList.remove("hidden");
		}else addInfo.classList.add("hidden");

		scrollToId("addInfo");
	}

	function editBank(e){
		document.querySelector("#addInfo").classList.add("hidden");

		let editInfo = document.querySelector("#editInfo");
		let editForm = document.querySelector("#editForm");
		
		editForm.elements["bankCode"].tomselect.setValue(e.getAttribute("data-bank-code"));
		editForm.elements["bankNumber"].value = e.getAttribute("data-bank-number");
		editForm.elements["userName"].value = e.getAttribute("data-user-name");

		editForm.elements["oldId"].value = e.getAttribute("data-bank-id");
		editForm.elements["oldNumber"].value = e.getAttribute("data-bank-number");

		if(e != currentEdit){
			editInfo.classList.remove("hidden");
			currentEdit = e;
		}else{
			editInfo.classList.add("hidden");
			currentEdit = null;
		}
		
		editValidate = true;
		scrollToId("editInfo");
	}
</script>

</body>

<!-- Mirrored from stackbros.in/bookinga/landing/account-payment-details.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 May 2025 16:07:33 GMT -->
</html>