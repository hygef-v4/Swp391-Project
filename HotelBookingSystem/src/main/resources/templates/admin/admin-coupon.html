<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý mã giảm giá</title>

    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/assets/images/favicon.ico}" />

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" />

    <!-- Plugins CSS -->
    <link rel="stylesheet" th:href="@{/assets/vendor/font-awesome/css/all.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/overlay-scrollbar/css/overlayscrollbars.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/choices/css/choices.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/glightbox/css/glightbox.css}" />

    <!-- Theme CSS -->
    <link rel="stylesheet" th:href="@{/assets/css/style.css}" />
</head>

<body>
<main>
    <div th:replace="~{common-admin/admin-sidebar :: admin_sidebar}"></div>
    <div class="page-content">
        <div th:replace="~{common-admin/admin-topbar :: admin_topbar}"></div>

        <div class="page-content-wrapper p-xxl-4">
            <div class="row mb-4">
                <div class="col-12 d-sm-flex justify-content-between align-items-center">
                    <h1 class="h3">Quản lý mã giảm giá</h1>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCouponModal">
                        <i class="bi bi-plus-circle me-2"></i>Thêm mã mới
                    </button>
                </div>
            </div>

            <!-- Search Form -->
            <form class="row mb-4" method="get" th:action="@{/admin-coupon}">
                <div class="col-md-6">
                    <input type="search" class="form-control" name="search" th:value="${search}" placeholder="Tìm theo mã coupon...">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary">Tìm kiếm</button>
                </div>
            </form>

            <!-- Coupon Table -->
            <div class="card">
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Mã</th>
                            <th>Loại</th>
                            <th>Giá trị</th>
                            <th>Ngày bắt đầu</th>
                            <th>Ngày kết thúc</th>
                            <th>Đã dùng</th>
                            <th>Giới hạn</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="coupon : ${coupons}">
                            <td th:text="${coupon.code}"></td>
                            <td th:text="${coupon.type}"></td>
                            <td th:text="${coupon.amount}"></td>
                            <td th:text="${coupon.validFrom}"></td>
                            <td th:text="${coupon.validUntil}"></td>
                            <td th:text="${coupon.usedCount}"></td>
                            <td th:text="${coupon.usageLimit}"></td>
                            <td>
                  <span th:text="${coupon.isActive ? 'Đang hoạt động' : 'Không hoạt động'}"
                        th:class="${coupon.isActive} ? 'badge bg-success' : 'badge bg-secondary'"></span>
                            </td>
                            <td>
                                <a href="#" class="btn btn-sm btn-light" th:attr="data-id=${coupon.couponId}" data-bs-toggle="modal" data-bs-target="#editCouponModal">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a th:href="@{'/admin/coupon/delete/' + ${coupon.couponId}}" class="btn btn-sm btn-danger" onclick="return confirm('Bạn có chắc muốn xóa?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Coupon Modal -->
            <div class="modal fade" id="addCouponModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <form class="modal-content" th:action="@{/admin/coupon/create}" method="post">
                        <div class="modal-header">
                            <h5 class="modal-title">Thêm mã giảm giá</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body row g-3">
                            <div class="col-12">
                                <label class="form-label">Mã</label>
                                <input type="text" class="form-control" name="code" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Loại</label>
                                <select class="form-select" name="type">
                                    <option value="percentage">Phần trăm</option>
                                    <option value="fixed">Cố định</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Giá trị</label>
                                <input type="number" step="0.01" name="amount" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Từ ngày</label>
                                <input type="date" name="validFrom" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Đến ngày</label>
                                <input type="date" name="validUntil" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Giới hạn sử dụng</label>
                                <input type="number" name="usageLimit" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tối thiểu tổng giá</label>
                                <input type="number" step="0.01" name="minTotalPrice" class="form-control">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Kích hoạt</label>
                                <input class="form-check-input" type="checkbox" name="isActive" checked>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Thêm mới</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</main>

<script th:src="@{/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/vendor/overlay-scrollbar/js/overlayscrollbars.min.js}"></script>
<script th:src="@{/assets/js/functions.js}"></script>
</body>
</html>
